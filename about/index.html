<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>about - Colin's linux blog</title>
  <meta name="author" content="Taolinran">

  
  <meta name="description" content="About Apr 13th, 2013 I&#8217;m Taolinran 91&#8217;s, I&#8217;m going to counterattack. A newbie! I love linux and there is my csdn blog! 1
2
3
4
5
6 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<style>

.nodebox {
  cursor: pointer;
  //fill: #E0EEEE;
  //fill: #fff;
  stroke: #FFEFDB;
  stroke-width: 1px;
}

#node_PHYSICAL                  .nodebox { stroke: beige;}
#node_PHYSICAL_HARD             .nodebox { stroke: tan;}
#node_PHYSICAL_SOFT             .nodebox { stroke: yellow;}

#node_BIOTA                     .nodebox { stroke: darkgreen;}
#node_BIOTA_SPONGES             .nodebox { stroke: orange;}
#node_BIOTA_ALGAE               .nodebox { stroke: green;}
#node_BIOTA_ALGAE_CANOPY_ECK    .nodebox { stroke: lightgreen;}
#node_BIOTA_ALGAE_CRUSTOSE      .nodebox { stroke: purple;}

.nodeTitle {
  /*font: 8px sans-serif;*/
  font: 12px "Microsoft YaHei" ! important;
  font-weight: bold;
}

.nodeText {
  font: 13px sans-serif;
}

.f1Text {
  fill: #6959CD;
  font-weight: bold;
}

.link {
  fill: none;
  stroke: #EECFA1;
  stroke-width: 3.5px;
}

</style>
  
  <link rel="canonical" href="http://lin-credible.github.io/about">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Colin's linux blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).bind('DOMNodeInserted', function(event) {
  addBlankTargetForLinks();
});
-->
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-40050631-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Colin</a></h1>
  
    <h2>I don't know where I'm going, but I'm on my way.</h2>

</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com.hk/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lin-credible.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">About</h1>
    <p class="meta">


<time datetime="2013-04-13T23:41:00+08:00" pubdate data-updated="true">Apr 13<span>th</span>, 2013</time></p>
  </header>
  <img src="https://cloud.githubusercontent.com/assets/3191641/5182053/2b3e2b88-74d8-11e4-87f5-d4d1aabb16ec.png" alt="alt text" /><br />
  <div id="colin" style="height:450px;padding:6px;"></div>
  <!--
  <h4>I&#8217;m <font color="#6B8E23">Colin</font>!I&#8217;m going to counterattack.</h4>
  -->
  <center>
	<p><img src="https://cloud.githubusercontent.com/assets/3191641/5182054/2b42ec4a-74d8-11e4-9e53-bb97f9f50b05.jpg" style="width:150px;height:150px;" alt="alt text" /><br />
  </center>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ [root@server ~]# 
</span><span class='line'>$ mysql&gt;help contents;
</span><span class='line'>$ #!/bin/bash
</span><span class='line'>$ vim /etc/*.conf -O
</span><span class='line'>$ ^&.+*#/%[{;@!$
</span><span class='line'>$ \&lt;\s\w+*\&gt;
</span><span class='line'>$ 8.8.8.8
</span><span class='line'>$ :!r sample.conf
</span><span class='line'>$ sed -e s:\{\"abc\":\\n\{\"abc\":g
</span><span class='line'>$ rewrite  ... 301
</span><span class='line'>$ include "colin_sb.c"
</span><span class='line'>$ php.ini a.py xxx docker...
</span><span class='line'>$ ...</span></code></pre></td></tr></table></div></figure>

<h2>All izz well</h2>
<h3>==========Tools==========</h3>

<p><img src="https://cloud.githubusercontent.com/assets/3191641/4367235/a6f191e0-42d1-11e4-85ae-b791c1844eaf.png" alt="alt text" /><br /></p>
<p><img src="https://cloud.githubusercontent.com/assets/3191641/4367236/a7f08e52-42d1-11e4-83e5-14bd6a3f5441.png" alt="alt text" /><br /></p>
<p><img src="https://cloud.githubusercontent.com/assets/3191641/4367237/a9896db0-42d1-11e4-930d-bec2562f58ad.png" alt="alt text" /><br /></p>




<h3>You do get what you want, if you know what you want and want the right thing...</h3>
    <footer>
      <p class="meta">


<time datetime="2013-04-13T23:41:00+08:00" pubdate data-updated="true">Apr 13<span>th</span>, 2013</time>
        
      </p>
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://lin-credible.github.io/about/index.html" data-via="linuxtaolinran" data-counturl="http://lin-credible.github.io/about/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'linblog'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script> 

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>
  </section>

</div>

<aside class="sidebar">
  
    <script charset="Shift_JIS" src="http://chabudai.sakura.ne.jp/blogparts/honehoneclock/honehone_clock_tr.js"></script>
<iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=300&skin=10&isTitle=1&noborder=1&isWeibo=1&isFans=0&uid=2116612302&verifier=c3e417d3&dpc=1"></iframe><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/09/dns-amplification-attacks/">DNS Amplification Attacks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/08/dns-and-selinux/">DNS and SELinux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/07/the-art-of-banning-ping-command/">The Art of Banning Ping Command and SYN Flood</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/02/controlling-the-nameserver/">Controlling the Nameserver</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/01/happy-51/">happy 51</a>
      </li>
    
  </ul>
</section>
<!--
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/linux-security/'>linux-security (3)</a></li>
<li class='category'><a href='/blog/categories/linux-services/'>linux-services (2)</a></li>
<li class='category'><a href='/blog/categories/tittle-tattle/'>tittle-tattle (3)</a></li>

  </ul>
</section>
-->
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li class='category'><a href='/blog/categories/linux-security/'>linux-security (3)</a></li>
<li class='category'><a href='/blog/categories/linux-services/'>linux-services (2)</a></li>
<li class='category'><a href='/blog/categories/tittle-tattle/'>tittle-tattle (3)</a></li>
</ul>
</section><section>
  <h1>Nice links</h1>
  <ul>
    <li>
      <a href="http://www.anonymoushackers.org/blog" target="_blank"><img src="/images/logo/anonymous.jpg" /></a>
    </li>
    <li>
      <a href="http://coolshell.cn/" target="_blank"><img src="/images/logo/coolshell.jpg" /></a>
    </li>
	<li>
      <a href="http://www.infoq.com/" target="_blank"><img src="/images/logo/infoQ.jpg" /></a>
    </li>
    <li>
      <a href="http://dbanotes.net/" target="_blank"><img src="/images/logo/dbanotes.jpg" /></a>
    </li>
	<li>
      <a href="http://www.dbthink.com/" target="_blank"><img src="/images/logo/dbthink.jpg" /></a>
    </li>
	 <li>
      <a href="http://www.mysqlpub.com/forum.php" target="_blank"><img src="/images/logo/mysqlpub.jpg" /></a>
    </li>
	<li>
      <a href="http://mindhacks.cn/" target="_blank"><img src="/images/logo/mindhacks.jpg" /></a>
    </li>
	<li>
      <a href="http://blog.linuxhonker.com/" target="_blank"><img src="/images/logo/linuxhonker.jpg" /></a>
    </li>
	<li>
      <a href="http://blog.yufeng.info/" target="_blank"><img src="/images/logo/yufeng.jpg" /></a>
    </li>
	<li>
      <a href="http://www.commandlinefu.com/commands/browse" target="_blank"><img src="/images/logo/commandline.jpg" /></a>
    </li>
	<li>
      <a href="http://dillinger.io/" target="_blank"><img src="/images/logo/dillinger.jpg" /></a>
    </li>
	<li>
      <a href="http://www.jiagulun.com/" target="_blank"><img src="/images/logo/jiagulun.jpg" /></a>
    </li>
	<li>
      <a href="http://blog.csdn.net/signmem" target="_blank"><img src="/images/logo/TerryTsang.jpg" /></a>
    </li>
	<li>
      <a href="http://kumu-linux.github.io/" target="_blank"><img src="/images/logo/kumulinux.jpg" /></a>
    </li>
	<li>
      <a href="http://blog.sina.com.cn/u/2116612302" target="_blank"><img src="/images/logo/sina.jpg" /></a>
    </li>
	<li>
      <a href="http://blog.csdn.net/c__ilikeyouma" target="_blank"><img src="/images/logo/csdn.jpg" /></a>
    </li>	
  </ul>
</section>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/113704455548006694120?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Taolinran -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  
  
 <script>

/*

easy to show system performance and network flow
base on  http://blog.bitjuice.com.au/2013/02/using-d3-js-to-visualise-hierarchical-classification/

features:
1)tree and connectivity(network) are both supported.
2)draggable nodes.
3)able to custom the config and actions

bug fix:
change dom property to class instead of dumplicated id

*/
function graph(d3){
//step 0, new graph() ,import "http://d3js.org/d3.v3.min.js" to get d3

//step 1, custom the config
this.config={
	bg_size:{width:800,height:450},	
	edge_def_width:5,
	edge_show_arrow:true,
	node_draggable:true,
	show_performance_bar:true,	
}

var self=this;
var cluster = d3.layout.cluster().size([self.config.bg_size.height, self.config.bg_size.width - 160]);


/// step 2, custom the actions
var showTitleAction;
var showSubheadAction;
var showPathDesc;

this.showTitle=function(f){
	showTitleAction=f;	
}

this.showSubhead=function(f){
	showSubheadAction=f;
}

this.showPathDesc=function(f){

	//showPathDesc=f;
}


/// final step , bind some data

this.bind=function(data){

	/**
	忽略连通图中的回路，产生一棵树。
	这棵树符合cluster.nodes(tree)的调用要求（参见：https://github.com/mbostock/d3/wiki/Cluster-Layout）	
	*/
	var conv2tree=function(data){
		var root=self.getRoot(data);
		var hasParentFlag={};//保证每个节点只有一个父节点，以便形成树状结构
		hasParentFlag[root.id]=true;//根节点不允许作为子节点
		self.traverseEdge(data,function(source,target){//遍历每条边，即所有节点间关系
			if(!hasParentFlag[target.id] && source.id!=target.id ){//首次被遍历到的target，作为source的子节点，后续将不被其它节点作为子节点
				if(!source.children){
					source.children=[];
				}
				source.children.push(target);
				hasParentFlag[target.id]=true;
			}
		});
		return root;
	}


	/**
		通过cluster.nodes(tree)，为tree的每个节点计算x，y，depth等属性以便定位		
	*/
	var buildNodes=function(tree){
		return cluster.nodes(tree);
	}

	/**
	建立节点之间各条边。
	如果直接调用cluster.links(nodes)，其只支持树状结构，回路会被丢弃，借此把所有边补充完整。
	*/
	var buildLinks=function(data){	
		var result=[];
		self.traverseEdge(data,function(source,target,ref){
			result.push({'source':source,'target':target,'ref':ref});
		});	
		return result;
	}

	/**
	更新数据时保留原有节点的位置信息
	*/
	var merge=function(nodes,links){
		
		var oldData=[];
		if(self.nodes){//原nodes存在，输出oldData
			self.nodes.forEach(function(d){
				oldData[d.id]=d;
			});
		}
		if(oldData){//用oldData里的数据覆盖现nodes里的数据
			nodes.forEach(function(d){
				if(oldData[d.id]){
					d.x=oldData[d.id].x;
					d.y=oldData[d.id].y;
				}
			});
		}
		
		
		self.nodes=nodes;
		self.links=links;
		
	}
	
	//1)连通图->树 参见：https://github.com/mbostock/d3/wiki/Cluster-Layout)	
	//1)temporarily convert a connectivity to a tree	
	var tree = conv2tree(data);
	//2)根据树状结构计算节点位置.
	//2)caculate for nodes' coords with <code>cluster.nodes(tree);</code>
	var nodes = buildNodes(tree); 
	//3)因为连通图是网状而非树状，将所有边补充完整
	//3)fill in all the edges(links) of the connectivity
	var links = buildLinks(data);
	//4)与原有的数据做一次merge，保留位置等信息
	//4)do merge to keep info like node's position
	merge(nodes,links);
	//5)重绘
	//5)redraw	
	self.redraw();
}


/// call redraw() if necessary (reconfig,recostom the actions, etc. )
this.redraw=function(){
	var fontSize = 8
	var lineSpace = 2
	var boxHeight = 50
	var boxWidth = 85

	var width = self.config.bg_size.width;
	var height = self.config.bg_size.height;

	var yscale_performancebar = d3.scale.linear()
									.domain([0,1])
									.rangeRound([boxHeight/2,-boxHeight/2])


	var diagonal = d3.svg.diagonal()
		.projection(function(d) { return [d.y-boxWidth/2, d.x]; });

		
	var _clear=function(){
		d3.select("svg").remove();
		
		svg = d3.select("#colin").append("svg")									
			.attr("width", width)
			.attr("height", height)
			  .append("g")
				.attr("transform", "translate(80,0)");
										
		svg.append("svg:defs").selectAll("marker")
			.data(["suit"])
			.enter().append("svg:marker")
			.attr("id", "idArrow")
			.attr("viewBox", "0 -5 10 10")
			.attr("refX", 15)
			.attr("refY", -1.5)
			.attr("markerWidth", 6)
			.attr("markerHeight", 6)
			.attr("orient", "auto")
		  .append("svg:path")
			.attr("d", "M0,-5L10,0L0,5");
	}	

	var _redrawEdges=function(){
		
		
		var linksWithArrow=self.links;
		
		//to show arrow at the end of the path with fixed size, we have to copy each path with .stroke-width=1 
		if(self.config.edge_show_arrow){
			linksWithArrow=[];
			self.links.forEach(function(d){
				
				var fake={};
				
				for( prop in d){
					fake[prop]=d[prop];
				}
				
				fake.faked=true;//copy each path with .faked=true as flag
				
				linksWithArrow.push(fake);
				linksWithArrow.push(d);
				
				 
			})
		}
		
		
		 
		var path=svg.selectAll(".link").data(linksWithArrow);
		
		
		// when new path arrives
		path.enter().insert("path",":first-child")			
			.attr("marker-end",function(d){
				if(d.faked) return "url(#idArrow)";
			})
			.attr("id",function(d){
				if(!d.faked) return "link"+d.ref.from+"-"+d.ref.to;
			})
			.attr("class", function(d){
				return "link"+" link-"+d.ref.from+" link-"+d.ref.to;
			})
			.attr("d", diagonal)
			.transition()
			.duration(1000)			
			.style("stroke-width", function(d){
				if(d.faked) {return 1.5;}
				if(d.ref.edge_width)
					return Math.max(1,boxHeight / 2 * d.ref.edge_width);//won't become invisible if too thin
				else
					return self.config.edge_def_width;//default value
			})
		
		// when path changes
		path
			.attr("d", diagonal)
		
		// when path's removed
		path.exit().remove();

	}
	
	_clear();
	
	_redrawEdges();
	
	//救了我的reverse.
	self.links.reverse();
	
	///show description on each path(edge)
	if(showPathDesc){
		svg.selectAll(".abc").data(self.links).enter().append("text").append("textPath")			
			.attr("xlink:xlink:href",function(d){return "#link"+d.ref.from+"-"+d.ref.to;})
			//why not .attr("xlink:href",...)? this's a hack, see https://groups.google.com/forum/?fromgroups=#!topic/d3-js/vLgbiM4ki1g			
			.attr("startOffset", "50%")
			.text(showPathDesc)
	}
	
	///show each node with text
	
	var existingNodes = svg.selectAll(".node").data(self.nodes);//选中所有节点
	
	//矩形
	//draw rectangle
	var newNodes = existingNodes.enter().append("g");	
	
	newNodes
		.attr("class", "node")
		.attr("id", function(d){return "node-"+d.id})
		.attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })					
			//.append("rect")//make nodes as rectangles OR:
			.append("circle").attr('r',48) //make nodes as circles
			.attr('class', 'nodebox')
				.attr("x", -boxWidth/2)
				.attr("y", -boxHeight/2)
				.attr("width", boxWidth)
				.attr("height", boxHeight)
				.style("fill", function(d) { return d.color; });
		
	if(self.config.node_draggable){
		newNodes.call(d3.behavior.drag().origin(Object).on("drag", function(d){ 
			
			//拖动时移动节点
			//translate the node
			function translate(x,y){
				return {'x':x,'y':y}
			}
			var coord=eval(d3.select(this).attr("transform"));			
			d3.select(this)
				.attr("transform", "translate(" + (coord.x+d3.event.dx)+ "," + (coord.y+d3.event.dy) + ")")		
			
			
			//拖动时重绘边			
			//update node's coord ,then redraw affected edges
			d.x=d.x+d3.event.dy;
			d.y=d.y+d3.event.dx;
			
			_redrawEdges();
		
					
		}));		
	}
	
	

	//红色柱状性能指示图
	//show performance bar
	if(self.config.show_performance_bar){
		newNodes.append("rect")
			.attr('class', 'performancebar')
			.attr("x", boxWidth/2*1.05)
			.attr("width", boxWidth/10)
			.style("fill", function(d){
				return (d.load > 0.6 ? "red": "green")
			})
			.style("stroke", function(d){
				return (d.load > 0.6 ? "red": "green")
			})
			.attr("y", boxHeight/2)
			.attr("height", 0)
			
		//计算柱状图高度
		existingNodes.select('.performancebar')
			.transition()
			.duration(1000)
			.attr("y", function(d){
				return yscale_performancebar(d.load)
			})
			.attr("height", function(d){
				return boxHeight/2 - yscale_performancebar(d.load)
			})	
	}
	
	
	newNodes.on("click", function (d) {
		if (d3.event.defaultPrevented) return;
		  itemclick(d.moduleid);
		});
	
	
	///构造文案容器
	///text constructors
	
	//标题
	//node titles
	newNodes.append("text")
		.attr("class", "nodeTitle")
		.style("font-size", "12px")
		.style("fill", "blue")
		.attr("y", -boxHeight/2 + fontSize + 2*lineSpace - 20)
		.attr("text-anchor", "middle")
	
	newNodes.append("svg:image")
        .attr("xlink:href", function(d){
        		if(d.stage=="child"){
        			return "https://cloud.githubusercontent.com/assets/3191641/5186157/83e86588-74ff-11e4-9716-271f6149eda5.jpg"
        		}else if(d.stage =="middle"){
        			return "https://cloud.githubusercontent.com/assets/3191641/5185918/ccdea54c-74fd-11e4-9dc2-786ea9cf7154.jpg"
        		}else if(d.stage =="middle_high"){
    				return "https://cloud.githubusercontent.com/assets/3191641/5185928/d37de0fc-74fd-11e4-9ddc-2606af184164.jpg"
        		}else if(d.stage =="high"){
    				return "https://cloud.githubusercontent.com/assets/3191641/5185925/d0963b46-74fd-11e4-8585-b3c174114963.jpg"
        		}else if(d.stage == "university"){
        			return "https://cloud.githubusercontent.com/assets/3191641/5186541/ed746c7a-7501-11e4-9639-21a5574c705d.jpg"
        		}else if(d.stage == "work"){
        			return "https://cloud.githubusercontent.com/assets/3191641/5186017/887dcc9c-74fe-11e4-9c70-5e41d03d16a5.jpg"
        		}else{
				return "https://cloud.githubusercontent.com/assets/3191641/5186057/d8f06626-74fe-11e4-89fa-ed1d5a76e8ef.png"
        		}
			})
        .attr("x", -1)
    	.attr("y", +10)
        .attr("width", "34")
        .attr("height", "34")

	
	
	
	//副标题
	//node subhead 
	newNodes.append("text")
	.attr("text-anchor", "middle")
	.attr("class", "nodeText f1Text")    
	.attr("y", -boxHeight/2 + 2*fontSize + 3*lineSpace - 10)
	
	//详情矩阵
	//node body text
	newNodes.append("g")
	.attr("class", "confusionmatrix")    
		.selectAll("g").data(function(d){return d.confusionmatrix?d.confusionmatrix:[]})
		.enter().append("g")
		.attr("class", "rows")
		.attr("transform", function(d,i) { return "translate("+(-15)+"," + (-boxHeight/2 + (i+3)*fontSize+(i+4)*lineSpace) + ")"; })
			.selectAll("g").data(function(d){return d})
			.enter().append("g")
			.attr("class", "columns")
			.attr("transform", function(d,i) { return "translate(" + i*30 + ",0)"; })
					.append("text")
						.attr("text-anchor", "middle")
						.attr("class", "nodeText")
	
	
	
	
	///显示文案
	///show text
	
	existingNodes.select(".nodeTitle").text(showTitleAction?showTitleAction:function(d){return d.id+")"+d.name});//标题
	existingNodes.select(".f1Text").text(showSubheadAction?showSubheadAction:function(d){return Math.round(d.load*100)+"%"});//副标题
	
	
	existingNodes.select(".confusionmatrix")//详情矩阵
		.selectAll(".rows")
		.data(function(d){return d.confusionmatrix?d.confusionmatrix:[]})
			.selectAll(".columns") //rows
			.data(function(d){return d})
			.select("text")
			.text(function(d){return d})		
	}			


	/**
	返回根节点
	return the root node
	*/
	this.getRoot=function(data){
		return data['0'];
	};

	/**
	遍历所有节点
	traverse all nodes
	callback(node)
	*/
	this.traverse=function (data,callback){
		if(!data) console.error('data is null')
		
		function _init(){
			var i;
			for(i in data){
				data[i].visited=false;
			} 
		}
		
		function _traverse(pt,callback){		
			if(!pt){return;}
			pt.visited=true;
			console.debug("traverse node:"+pt.id);
			callback(pt);		
			if(pt.ref){
				pt.ref.forEach(function(ref){
					var childNode=data[ref.to.toString()];
					if(childNode && !childNode.visited){
						_traverse(childNode,callback);
					}
				})
			}
			
			
			
		}
		
		_init();
		_traverse(self.getRoot(data),callback);
	};

	/**
	遍历所有边
	traverse all edges
	callback(sourceNode,targetNode,ref)
	*/
	this.traverseEdge=function (data,callback){
		if(!data) console.error('data is null')
		
		self.traverse(data,function(node){
			if(node.ref){
				node.ref.forEach(function(ref){
					var childNode=data[ref.to.toString()];
					if(childNode){
						console.debug("traverse edge:"+node.id+"-"+childNode.id);
						callback(node,childNode,ref);					
					}
				});
			}
		});
	};
}
</script>


<script>

function itemclick(id) {
	window.open("http://blog.csdn.net/lin_credible");
}


function refresh(){

	
	//request data here
	var data={
	"0":{
		id:0,
		name:"Born",
		stage:"child",
		layout:"Hunan",
		//load:Math.random(),
		load:0.2,
		color:"#FFF68F",
		confusionmatrix: [[1991],['June']],
		//confusionmatrix: [['测试模块'],['逻辑SPP']],
		ref:[
			{
				from:0,
				to:1,
				//edge_width:Math.random(),
				edge_width:0.1,
				
			},
			{
				from:0,
				to:6,
				//edge_width:Math.random(),
				edge_width:0.1,
				
			}
		]
	},
	"1":{
		id:1,
		name:"Primary school",
		stage:"middle",
		layout: "Naughty",
		//load:Math.random(),
		load:0.2,
		color:"#DAA520",
		confusionmatrix: [['Miss'],['Grandpa.']],
		ref:[
			{
				from:1,
				to:2,
				edge_width:0.1,
			},
		]
	},
	"2":{
		id:2,
		name:"Junior high school",
		stage:"middle_high",
		layout: "Very Happy",
		//load:Math.random(),
		load:0.3,
		color:"#DDA0DD",
		confusionmatrix: [['Balls'],['Games']],
		ref:[
			{
				from:2,				
				to:3,
				edge_width:0.1,
			},
		]
	},
	"3":{
		id:3,
		name:"Senior middle school",
		stage:"high",
		layout:"Start Thinking",
		load:0.5,
		color:"#FFAEB9",
		confusionmatrix: [['Balls'],['Exam']],
		ref:[
			{
				from:3,				
				to:4,
				edge_width:0.1,
			},
		]
	},
	"4":{
		id:4,
		name:"University",
		stage:"university",
		layout: "Friends & Miss",
		load:0.5,
		color:"#FFA54F",
		confusionmatrix: [['Study'],['Thanks']],
		ref:[
			{
				from:4,				
				to:5,
				edge_width:0.1,
			},
			{
				from:4,				
				to:6,
				edge_width:0.1,
				
			}
		]
	},
	"5":{
		id:5,
		name:"Work",
		stage:"work",
		layout: "Experience & Thanks",
		load:0.8,
		color:"#7CCD7C",
		confusionmatrix: [['Linux'],['Code']],
		ref:[
			{
				from:5,				
				to:6,
				edge_width:0.1,
			},
		]
	},
	"6":{
		id:6,
		name:"Future",
		stage:"future",
		layout: "Don't konw?",
		load:0.8,
		color:"#C1FFC1",
		confusionmatrix: [['Life'],['Dream']]
	}
};
	
	//d3.json("core1.json", function(error, data) {

	//customize anything here
	myGraph.showTitle(function(d){
		return d.name;
	});
	
	myGraph.showSubhead(function(d){
		//return "p0";
		return d.layout;
	});
	
	myGraph.showPathDesc(function(d){
		return d.ref.edge_width.toFixed(2);
	});	
	
	myGraph.bind(data);
	//});
	
}


function refresh2(){
	//request data here 
	var data={
	"0":{
		id:0,
		name:"systemA",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
		ref:[
			{
				from:0,
				to:1,
				edge_width:Math.random(),
			},
			{
				from:0,
				to:4,
				edge_width:Math.random(),
			},
			{
				from:0,
				to:5,
				edge_width:Math.random(),
			},
			/*
			{
				from:0,
				to:6,
				edge_width:Math.random(),
			},
			*/
			{
				from:0,
				to:7,
				edge_width:Math.random(),
			},
		]
	},
	"1":{
		id:1,
		name:"systemB",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
		ref:[
			{
				from:1,
				to:2,
				edge_width:Math.random(),
			},
		]
	},
	"2":{
		id:2,
		name:"systemC",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
		ref:[
			{
				from:2,				
				to:3,
				edge_width:Math.random(),
			},
		]
	},
	"3":{
		id:3,
		name:"systemD",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
	},
	"4":{
		id:4,
		name:"systemE",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
		ref:[
			{
				from:4,
				to:2,
				edge_width:Math.random(),
			},
			{
				from:4,
				to:8,
				edge_width:Math.random(),
			},
		]
	},
	"5":{
		id:5,
		name:"systemF",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
	},
	"8":{// change 6 to 8
		id:8,
		name:"systemI",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
		ref:[
			{
				from:8,
				to:7,
				edge_width:Math.random(),
			},
		]
	},	
	"7":{
		id:7,
		name:"systemH",
		load:Math.random(),
		confusionmatrix: [[7293, 1224],[7293, 1224]],
		ref:[
			{
				from:7,
				to:3,
				edge_width:Math.random(),
			},
		]
	},	
};

	myGraph.bind(data);
	
}

var myGraph=new graph(d3);//http://d3js.org/

refresh();
	
</script>

<script type="text/javascript">
      var disqus_shortname = 'linblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://lin-credible.github.io/about/index.html';
        var disqus_url = 'http://lin-credible.github.io/about/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
